@let _showOptions = showOptions(); @let _placeholder = placeholder();

<div
	(clickOutside)="toggleOptions(false)"
	style="color: black"
	class="w-select"
>
	<!-- Label for the select field -->
	@if (label) {
	<div class="w-select__label">{{ 'Select.' + label | translate }}</div>
	}

	<!-- Select body containing the selected item(s) and dropdown -->
	<div
		[class._disabled]="disabled()"
		[class._active]="_showOptions"
		class="w-select__body"
	>
		<!-- Select header with the selected item(s) -->
		<div (click)="toggleOptions()" class="w-select__header">
			<span class="material-icons">unfold_more</span>
			<!-- Display the selected items -->
			<ng-container
				[ngTemplateOutlet]="t_view ? t_view : defaultView"
			></ng-container>
			<ng-template #defaultView>
				<div class="w-select__text">
					@if (multiple) {
					<div class="text-overflow">
						@if (!_values.length) {
						<div>{{'Select.' + _placeholder | translate }}</div>
						} @for (id of _values; track id; let i = $index) {
						<span>
							@if (i) {
							<span>, </span>
							} @if (_items[id] && _items[id] !== 0) {
							<span
								>{{ 'Select.' + _items[id][name] | translate }}
								<i
									(click)="_values.splice(i, 1); modelChange.emit(_values)"
									class="material-icons avatar__icon"
									>close</i
								>
							</span>
							}
						</span>
						}
					</div>
					} @if (!multiple) {
					<div class="text-overflow">
						{{'Select.' + (_selected || _placeholder) | translate }}
					</div>
					}
				</div>
			</ng-template>
		</div>

		<!-- Clearable icon -->
		@if (clearable() && _selected) {
		<div
			class="w-select__arrow material-icons"
			(click)="clear(); _selected = ''"
		>
			close
		</div>
		}

		<!-- Dropdown arrow -->
		<div
			class="w-select__arrow material-icons"
			[class._active]="_showOptions"
			(click)="toggleOptions()"
		>
			expand_more
		</div>

		<!-- Dropdown menu -->
		@if (_showOptions) {
		<div [class._search]="searchable" class="w-select__popup">
			@if (searchable) {
			<div>
				<ng-container
					[ngTemplateOutlet]="t_search ? t_search : defaultSearch"
				></ng-container>
				<ng-template #defaultSearch>
					<winput
						(wChange)="search.set($event + '')"
						placeholder="{{'Select.Enter search text...' | translate}}"
					/>
				</ng-template>
			</div>
			}
			<!-- Items list -->
			<div class="popup-block">
				@for (_item of (items | search: search(): searchableBy + '
				__search'); track _item) {
				<ng-container
					[ngTemplateOutlet]="t_item ? t_item : defaultItem"
					[ngTemplateOutletContext]="{ item: _item }"
				></ng-container>
				} @if (!(items | search: search(): searchableBy + '
				__search')?.length) {
				<div class="popup-block__empty-search" translate>
					Select.Nothing was found
				</div>
				}
			</div>
			<ng-template #defaultItem let-item="item">
				<div
					[class.disabled]="this._values.indexOf(item.value) !== -1"
					(click)="item_onclick(item)"
					class="item"
				>
					<div
						[class.selected]="_values.indexOf(item[value]) !== -1"
						class="item__text"
					>
						{{ 'Select.' + item[name] | translate }}
					</div>
				</div>
			</ng-template>
		</div>
		}
	</div>
</div>
