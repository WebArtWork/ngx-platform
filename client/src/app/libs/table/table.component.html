<div
	class="w-full max-w-full mx-auto rounded-lg bg-white shadow overflow-hidden"
>
	<!-- Header -->
	<div class="px-3 py-3 sm:px-4 border-b border-slate-200">
		<div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
			<h3 class="m-0 font-semibold text-slate-800 text-base leading-5">
				{{ title() }}
			</h3>

			@if (headerTpl()) {
			<div class="min-w-0 sm:min-w-[220px]">
				<ng-container
					[ngTemplateOutlet]="headerTpl()?.template"
				></ng-container>
			</div>
			} @if (config().searchable) {
			<div class="flex-1 min-w-0 sm:mx-3">
				<div class="relative flex items-center">
					<input
						class="w-full h-11 rounded-md px-3 pr-11 bg-white text-slate-800 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-600"
						type="text"
						placeholder="Search..."
						[(ngModel)]="searching_text"
						(ngModelChange)="searching()"
						(keyup.enter)="search(); searchShow = false"
					/>
					<button
						type="button"
						class="absolute right-1 top-1/2 -translate-y-1/2 inline-flex items-center justify-center h-9 w-9 rounded-md hover:bg-black/5"
						(click)="search(); searchShow = false"
						aria-label="Search"
					>
						<span class="material-icons material-symbols-outlined">
							search
						</span>
					</button>
				</div>
			</div>
			}

			<!-- Header actions -->
			<div class="flex items-center gap-2 sm:ml-auto">
				@if (config().headerButtons) { @for (button of
				config().headerButtons; track button) { @if (button) {
				<wbutton
					[disableSubmit]="true"
					[extraClass]="
									'inline-flex items-center justify-center h-11 min-w-[44px] px-2 ' +
									(button.class || '')
								"
					(wClick)="button.click()"
				>
					@if (button.icon) {
					<i class="material-icons" [title]="button.icon">
						{{ button.icon }}
					</i>
					} @if (button.text) {
					<span class="whitespace-nowrap">{{ button.text }}</span>
					}
				</wbutton>
				} } } @if (config().create) {
				<wbutton
					[disableSubmit]="true"
					[extraClass]="'inline-flex items-center justify-center h-11 min-w-[44px] px-2'"
					(wClick)="config().create()"
				>
					<i class="material-icons" title="Add"> add </i>
				</wbutton>
				}
			</div>
		</div>
	</div>

	<!-- Table -->
	<div class="w-full overflow-x-auto">
		<table class="w-full border-collapse" cellpadding="0" cellspacing="0">
			<thead class="wtable__thead">
				<tr>
					@if (config().num) {
					<th
						scope="col"
						class="h-12 px-4 text-left font-medium text-slate-700 border-b border-slate-200 whitespace-nowrap"
					>
						No.
					</th>
					} @for (column of columns(); track column) {
					<th
						scope="col"
						class="h-12 px-4 text-left font-medium text-slate-700 border-b border-slate-200 whitespace-nowrap"
					>
						<div
							class="inline-flex items-center gap-2 relative select-none cursor-pointer"
							[class.is-activeDown]="
								sort_type.direction === 'desc' &&
								column.field === sort_type.title
							"
							[class.is-activeUp]="
								sort_type.direction === 'asc' &&
								column.field === sort_type.title
							"
							(click)="sort(column)"
						>
							<span class="truncate">{{ column.title }}</span>

							@if (sortable[column.field]) {
							<span class="material-icons wtable__sort-icon">
								keyboard_backspace
							</span>
							}
						</div>
					</th>
					} @if (config().delete || config().update ||
					config().buttons?.length) {
					<th
						scope="col"
						class="h-12 px-4 text-left font-medium text-slate-700 border-b border-slate-200 whitespace-nowrap"
					>
						@if (action) {
						<ng-container
							*ngTemplateOutlet="action.template"
						></ng-container>
						} @else { Actions }
					</th>
					}
				</tr>
			</thead>

			<tbody>
				@let _cfg = config(); @for (row of _cfg.allDocs ?
				paginatedRows() : normalizedRows(); track row[bindValue()] ) {
				<tr class="hover:bg-black/[0.02]">
					@if (_cfg.num) {
					<td
						class="wtable__td px-4 py-2 text-sm text-slate-700 border-b border-slate-200"
						data-label="No.: "
					>
						{{ row.num }}
					</td>
					} @for (column of columns(); track column) { @if
					(custom_cell[column.field]) {
					<td
						class="wtable__td px-4 py-2 text-sm text-slate-700 border-b border-slate-200"
						[attr.data-label]="column.title + ': '"
					>
						<ng-container
							*ngTemplateOutlet="custom_cell[column.field]; context: { $implicit: row }"
						></ng-container>
					</td>
					} @else {
					<td
						class="wtable__td px-4 py-2 text-sm text-slate-700 border-b border-slate-200"
						[attr.data-label]="column.title + ': '"
					>
						{{ row[column.field] }}
					</td>
					} } @if (_cfg.delete || _cfg.update || _cfg.buttons?.length)
					{
					<td
						class="wtable__td px-4 py-2 text-sm text-slate-700 border-b border-slate-200"
						data-label="Actions: "
					>
						<div class="inline-flex items-center gap-2">
							@for (button of _cfg.buttons || []; track button) {
							@if (button) { @if (!button.ahref &&
							!button.ahrefFunc && !button.href &&
							!button.hrefFunc) {
							<i
								class="material-icons text-slate-600 hover:text-blue-600 cursor-pointer transition"
								[title]="button.icon"
								(click)="button.click(row)"
							>
								{{ button.icon }}
							</i>
							} @if (button.ahref) {
							<a
								[href]="button.ahref"
								[target]="button.target || '_blank'"
								class="inline-flex"
							>
								<i
									class="material-icons text-slate-600 hover:text-blue-600 transition"
									[title]="button.icon"
								>
									{{ button.icon }}
								</i>
							</a>
							} @if (button.ahrefFunc) {
							<a
								[href]="button.ahrefFunc(row)"
								[target]="button.target || '_blank'"
								class="inline-flex"
							>
								<i
									class="material-icons text-slate-600 hover:text-blue-600 transition"
									[title]="button.icon"
								>
									{{ button.icon }}
								</i>
							</a>
							} @if (button.href) {
							<a [routerLink]="button.href" class="inline-flex">
								<i
									class="material-icons text-slate-600 hover:text-blue-600 transition"
									[title]="button.icon"
								>
									{{ button.icon }}
								</i>
							</a>
							} @if (button.hrefFunc) {
							<a
								[routerLink]="button.hrefFunc(row)"
								class="inline-flex"
							>
								<i
									class="material-icons text-slate-600 hover:text-blue-600 transition"
									[title]="button.icon"
								>
									{{ button.icon }}
								</i>
							</a>
							} } } @if (_cfg.update) {
							<i
								class="material-icons text-slate-600 hover:text-blue-600 cursor-pointer transition"
								title="Edit"
								(click)="_cfg.update(row)"
							>
								edit
							</i>
							} @if (_cfg.delete) {
							<i
								class="material-icons text-slate-600 hover:text-blue-600 cursor-pointer transition"
								title="Delete"
								(click)="_cfg.delete(row)"
							>
								delete_outline
							</i>
							}
						</div>
					</td>
					}
				</tr>
				}
			</tbody>

			@if (_cfg.perPage || (_cfg.formCreate && _cfg.create)) {
			<tfoot class="border-t border-slate-200">
				<tr>
					<td
						[attr.colspan]="
							columns().length +
							(config().delete || config().update || config().buttons?.length ? 1 : 0) +
							(config().num ? 1 : 0)
						"
						class="px-4 py-3"
					>
						<div
							class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"
						>
							@if (_cfg.perPage) {
							<div
								class="flex items-center flex-wrap gap-x-2 gap-y-1 text-xs text-slate-700"
							>
								<div>Showing items per page</div>

								<div
									class="relative font-semibold"
									(clickOutside)="select_page_size = false"
								>
									<div
										class="px-3 py-2 rounded-md border border-slate-200 cursor-pointer select-none hover:bg-black/[0.03]"
										(click)="select_page_size = !select_page_size"
									>
										{{ _cfg.perPage === -1 ? 'All' :
										_cfg.perPage }}
									</div>

									@if (select_page_size) {
									<div
										class="absolute bottom-full mb-2 left-0 w-full rounded-lg border border-slate-200 bg-white shadow-lg overflow-hidden z-[999]"
									>
										@for (pageSize of _cfg.pageSizeOptions;
										track pageSize) {
										<div
											class="px-3 py-2 text-center cursor-pointer hover:bg-black/[0.03]"
											[class.font-bold]="_cfg.perPage === pageSize"
											[class.text-blue-600]="_cfg.perPage === pageSize"
											(click)="changePerPage(pageSize)"
										>
											{{ pageSize }}
										</div>
										} @if (_cfg.allDocs) {
										<div
											class="px-3 py-2 text-center cursor-pointer hover:bg-black/[0.03]"
											[class.font-bold]="_cfg.perPage === -1"
											[class.text-blue-600]="_cfg.perPage === -1"
											(click)="changePerPage(-1)"
										>
											All
										</div>
										}
									</div>
									}
								</div>

								@if (_cfg.perPage >= 0 && !_cfg.allDocs) {
								<div>Page {{ _cfg.page }}</div>
								} @if (_cfg.perPage >= 0 && _cfg.allDocs) {
								<div>
									<span
										>{{ ((_cfg.page - 1) * _cfg.perPage) + 1
										}}</span
									>
									<span> - </span>
									<span>
										{{ (_cfg.page * _cfg.perPage >
										totalCount() && totalCount()) ||
										(_cfg.page * _cfg.perPage) }}
									</span>
									<span> of </span>
									<span>{{ totalCount() }}</span>
								</div>
								}
							</div>
							}

							<!-- Pagination -->
							@if (_cfg.perPage !== -1 && _cfg.allDocs) {
							<div
								class="inline-flex items-center gap-2 sm:ml-auto"
							>
								<wbutton
									[extraClass]="'inline-flex items-center justify-center h-9 w-9 p-0'"
									[isMultipleClicksAllowed]="true"
									[disabled]="_cfg.page === 1"
									(wClick)="firstPage()"
								>
									<span class="material-icons"
										>keyboard_double_arrow_left</span
									>
								</wbutton>

								<wbutton
									[extraClass]="'inline-flex items-center justify-center h-9 w-9 p-0'"
									[isMultipleClicksAllowed]="true"
									[disabled]="_cfg.page === 1"
									(wClick)="previous()"
								>
									<span class="material-icons"
										>chevron_left</span
									>
								</wbutton>

								<wbutton
									[extraClass]="'inline-flex items-center justify-center h-9 w-9 p-0'"
									[isMultipleClicksAllowed]="true"
									[disabled]="_cfg.page * _cfg.perPage > totalCount()"
									(wClick)="next()"
								>
									<span class="material-icons"
										>chevron_right</span
									>
								</wbutton>

								<wbutton
									[extraClass]="'inline-flex items-center justify-center h-9 w-9 p-0'"
									[isMultipleClicksAllowed]="true"
									[disabled]="isLast()"
									(wClick)="lastPage()"
								>
									<span class="material-icons"
										>keyboard_double_arrow_right</span
									>
								</wbutton>
							</div>
							} @if (!_cfg.allDocs) {
							<div
								class="inline-flex items-center gap-2 sm:ml-auto"
							>
								<wbutton
									[extraClass]="'inline-flex items-center justify-center h-9 w-9 p-0'"
									[isMultipleClicksAllowed]="true"
									[disabled]="_cfg.page === 1"
									(wClick)="previous()"
								>
									<span class="material-icons"
										>chevron_left</span
									>
								</wbutton>

								<wbutton
									[extraClass]="'inline-flex items-center justify-center h-9 w-9 p-0'"
									[disabled]="normalizedRows().length !== _cfg.perPage"
									[isMultipleClicksAllowed]="true"
									(wClick)="next()"
								>
									<span class="material-icons"
										>chevron_right</span
									>
								</wbutton>
							</div>
							}
						</div>
					</td>
				</tr>
			</tfoot>
			}
		</table>
	</div>
</div>
