import{b as U}from"./chunk-33V2VOW6.js";import"./chunk-7PDZPIOI.js";import"./chunk-FTLRRYIQ.js";import"./chunk-XQJPQ7LG.js";import{a as N}from"./chunk-AATAVEAB.js";import"./chunk-JCGHU3MU.js";import{f as I}from"./chunk-J5IRV576.js";import{C as V,a as S,n as k,u as x,v as P,w as F,z as c}from"./chunk-QO64SOUP.js";import{Aa as l,Ba as m,C as g,H as v,I as h,Ia as C,Ka as u,Ma as p,P as y,Za as w,_ as t,ea as D,pa as s,qa as a,sa as T,sb as _,ta as E,ya as d,za as n}from"./chunk-L3JEUUTS.js";import{a as b,b as M}from"./chunk-6MDQTQU3.js";var A=F(i=>{c(i.name,{message:"Enter your name..."}),c(i.phone,{message:"Enter your phone..."}),c(i.bio,{message:"Enter your biography..."})}),j=F(i=>{c(i.currentPassword,{message:"Enter your current password..."}),c(i.newPassword,{message:"Enter your new password..."}),c(i.confirmPassword,{message:"Confirm your new password..."})});function W(i,H){if(i&1){let e=C();n(0,"div",4)(1,"ngx-file",5),u("wImageChange",function(r){v(e);let f=p();return h(f.updateThumb(r||""))}),l(),n(2,"form",6),u("submit",function(r){return v(e),p().wFormSubmit(),h(r.preventDefault())}),m(3,"winput",7),s(),m(4,"winput",8),s(),m(5,"winput",9),s(),n(6,"wbutton",10),w(7," Update "),l()()()}if(i&2){let e=p();t(),d("wImage",e.userService.thumb())("container","user")("name",e.userService.user()._id+".jpg")("accept","image/*")("clearable",!1)("preview",!0)("cropWidth",512)("cropHeight",512),t(2),a(e.profileForm.name,"formField"),t(),a(e.profileForm.phone,"formField"),t(),a(e.profileForm.bio,"formField"),t(),d("disabled",e.isSubmitDisabled())}}function q(i,H){if(i&1){let e=C();n(0,"div",4)(1,"form",6),u("submit",function(r){return v(e),p().wSecuritySubmit(),h(r.preventDefault())}),m(2,"winput",11),s(),m(3,"winput",12),s(),m(4,"winput",13),s(),n(5,"wbutton",10),w(6," Update password "),l()()()}if(i&2){let e=p();t(2),a(e.securityForm.currentPassword,"formField"),t(),a(e.securityForm.newPassword,"formField"),t(),a(e.securityForm.confirmPassword,"formField"),t(),d("disabled",e.isSecurityDisabled())}}var ie=(()=>{class i{constructor(){this.userService=g(N),this._emitterService=g(k),this.activeTab=y("profile"),this._initialProfile=_(()=>{let e=this.userService.user();return{name:e.name||"",phone:e.phone||"",bio:e.bio||""}}),this.profileModel=y(this._initialProfile()),this.profileForm=x(this.profileModel,A),this.isSubmitDisabled=_(()=>this.profileForm().invalid()),this.securityModel=y({currentPassword:"",newPassword:"",confirmPassword:""}),this.securityForm=x(this.securityModel,j),this.isSecurityDisabled=_(()=>{let e=this.securityModel();return this.securityForm().invalid()||e.newPassword!==e.confirmPassword}),this._emitterService.onComplete("us.user").pipe(S()).subscribe(()=>{this.profileModel.set(this._initialProfile()),this.profileForm().reset()})}setTab(e){this.activeTab.set(e)}wFormSubmit(){P(this.profileForm,e=>(this.userService.user.set(b(b({},this.userService.user()),e().value())),this.userService.updateMe(),Promise.resolve()))}wSecuritySubmit(){P(this.securityForm,e=>{let o=e().value();return this.userService.changePassword(o.currentPassword,o.newPassword).pipe(S()).subscribe({next:()=>{this.securityForm().reset(),this.securityModel.set({currentPassword:"",newPassword:"",confirmPassword:""})}}),Promise.resolve()})}updateThumb(e){this.userService.user.set(M(b({},this.userService.user()),{thumb:e})),this.userService.updateMe()}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=D({type:i,selectors:[["ng-component"]],decls:10,vars:5,consts:[[1,"grid","gap-4"],[1,"flex","flex-col","gap-4","rounded-[var(--radius-card)]","border","border-[var(--c-border)]","bg-[var(--c-bg-secondary)]","p-5","shadow-[var(--shadow-sm)]","sm:p-4"],[1,"mb-3","flex","gap-3","border-b","border-[var(--c-border)]","pb-3"],[1,"!font-semibold","!text-[0.9rem]",3,"click","type","isMultipleClicksAllowed"],[1,"flex","flex-col","gap-3"],["mode","single-image","view","thumb-only",3,"wImageChange","wImage","container","name","accept","clearable","preview","cropWidth","cropHeight"],[1,"flex","flex-col","gap-3",3,"submit"],["placeholder","Enter your name...",3,"formField"],["placeholder","Enter your phone...","type","tel",3,"formField"],["placeholder","Enter your bio...","type","textarea",3,"formField"],["type","primary",1,"mt-2",3,"disabled"],["placeholder","Enter your current password...","type","password",3,"formField"],["placeholder","Enter your new password...","type","password",3,"formField"],["placeholder","Confirm your new password...","type","password",3,"formField"]],template:function(o,r){o&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"wbutton",3),u("click",function(){return r.setTab("profile")}),w(4," Profile "),l(),n(5,"wbutton",3),u("click",function(){return r.setTab("security")}),w(6," Security "),l()(),n(7,"div",4),T(8,W,8,15,"div",4)(9,q,7,7,"div",4),l()()()),o&2&&(t(3),d("type",r.activeTab()==="profile"?"primary":"link")("isMultipleClicksAllowed",!0),t(2),d("type",r.activeTab()==="security"?"primary":"link")("isMultipleClicksAllowed",!0),t(3),E(r.activeTab()==="profile"?8:9))},dependencies:[I,V,U],encapsulation:2,changeDetection:0})}}return i})();export{ie as ProfileComponent};
