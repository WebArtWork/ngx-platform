import{i as n,m as u,n as c,o as d,p as m,u as s}from"./chunk-WKLHJP3I.js";import{A as i,Kb as l,N as o,w as h}from"./chunk-SEEX5V2H.js";var b=(()=>{let r=class r extends m{role(e){return!!(this.user().is||{})[e]}constructor(){super({name:"user",replace:e=>{e.roles=[],e.data=e.data||{};for(let t of s.userFields||[])e.data[t]=e.data[t]||{};for(let t of this.roles)e.is[t]&&e.roles.push(t);return e}}),this.url=s.url,this.roles=(s.roles||[]).concat(["admin"]),this.employees=s.roles||[],this.theme="dark",this.themes=(s.themes||[]).concat(["dark","white"]),this.users=o(this.getDocs()),this.user=o(localStorage.getItem("waw_user")?JSON.parse(localStorage.getItem("waw_user")):this.new()),this.thumb=o(!this.user().thumb||this.user().thumb.includes("assets/default.png")?"assets/default.png":this.url+this.user().thumb),this.usersByRole={},this._changingPassword=!1,this._httpService=i(c),this._storeService=i(d),this._alertService=i(n),this._router=i(l),this._emitterService=i(u),this.filteredDocuments({},{field:"roles",filtered:e=>{for(let t in e)this.usersByRole[t]?this.usersByRole[t].set(e[t]):this.usersByRole[t]=o(e[t])}}),this._storeService.get("mode",e=>{e?this.setTheme(e):this.setTheme("dark")}),localStorage.getItem("waw_user")&&(this.fetch({},{name:"me"}).subscribe(e=>{e?(!localStorage.getItem("waw_user")&&this._router.url==="/sign"&&this._router.navigateByUrl("/profile"),this.setUser(e)):localStorage.getItem("waw_user")&&this.logout()}),this.get({query:s.appId?"appId="+s.appId:""}))}toggleTheme(){this.setTheme(this.theme==="dark"?"white":"dark")}setTheme(e="white"){if(e==="white"){this._storeService.remove("theme");for(let t of this.themes)document.body.parentNode.classList.remove(t)}else this._storeService.set("theme",e),document.body.parentNode.classList.add(e);this.theme=e}setUser(e){this.user.set(e),localStorage.setItem("waw_user",JSON.stringify(e)),this._emitterService.complete("us.user")}updateMe(){this.setUser(this.user()),this.update(this.user())}updateMeAfterWhile(){this.setUser(this.user()),this.updateAfterWhile(this.user())}changePassword(e,t){this._changingPassword||(this._changingPassword=!0,this._httpService.post("/api/user/changePassword",{newPass:t,oldPass:e},g=>{this._changingPassword=!1,g?this._alertService.info({text:"Successfully changed password"}):this._alertService.error({text:"Incorrect current password"})}))}logout(){this.user.set(this.new()),localStorage.removeItem("waw_user"),this._httpService.remove("token"),this._httpService.get("/api/user/logout"),this._router.navigateByUrl("/sign"),setTimeout(()=>{location.reload()},100)}updateAdmin(e){this.update(e,{name:"admin"})}deleteAdmin(e){this.delete(e,{name:"admin"})}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();export{b as a};
