import{a as m}from"./chunk-73YO2PIT.js";import{p as l,q as u,r as c,s as n,v as s}from"./chunk-4NITVLUQ.js";import{B as r,O as o,Zb as h,x as a}from"./chunk-VOU2RNQA.js";var b=(()=>{class i extends n{role(e){return!!(this.user().is||{})[e]}constructor(){super({name:"user",replace:e=>{e.roles=[],e.data=e.data||{};for(let t of s.userFields||[])e.data[t]=e.data[t]||{};for(let t of this.roles)e.is[t]&&e.roles.push(t);return e}}),this._httpService=r(u),this._storeService=r(c),this._alertService=r(m),this._router=r(h),this._emitterService=r(l),this.url=s.url,this.roles=(s.roles||[]).concat(["admin"]),this.employees=s.roles||[],this.theme="dark",this.themes=(s.themes||[]).concat(["dark","light"]),this.users=o(this.getDocs(),{}),this.user=o(localStorage.getItem("waw_user")?JSON.parse(localStorage.getItem("waw_user")):this.new(),{}),this.thumb=o(!this.user().thumb||this.user().thumb.includes("assets/default.png")?"assets/default.png":this.url+this.user().thumb,{}),this.usersByRole={},this.filteredDocuments({},{field:"roles",filtered:e=>{for(let t in e)this.usersByRole[t]?this.usersByRole[t].set(e[t]):this.usersByRole[t]=o(e[t])}}),this._storeService.get("mode",e=>{e?this.setTheme(e):this.setTheme("dark")}),localStorage.getItem("waw_user")&&(this.fetch({},{name:"me"}).subscribe(e=>{e?(!localStorage.getItem("waw_user")&&this._router.url==="/sign"&&this._router.navigateByUrl("/profile"),this.setUser(e)):localStorage.getItem("waw_user")&&this.logout()}),this.get({query:s.appId?"appId="+s.appId:""}))}toggleTheme(){this.setTheme(this.theme==="dark"?"light":"dark")}setTheme(e="light"){if(e==="light"){this._storeService.remove("theme");for(let t of this.themes)document.body.parentNode.classList.remove(t)}else this._storeService.set("theme",e),document.body.parentNode.classList.add(e);this.theme=e}setUser(e){this.user.set(e),localStorage.setItem("waw_user",JSON.stringify(e)),this._emitterService.complete("us.user")}updateMe(){return this.setUser(this.user()),this.update(this.user()).subscribe(()=>{this._alertService.info({text:"Profile information has been updated"})})}updateMeAfterWhile(){this.setUser(this.user()),this.updateAfterWhile(this.user())}changePassword(e,t){return this._httpService.post("/api/user/changePassword",{newPass:t,oldPass:e},d=>{d?this._alertService.info({text:"Successfully changed password"}):this._alertService.error({text:"Incorrect current password"})})}logout(){this.user.set(this.new()),localStorage.removeItem("waw_user"),this._httpService.remove("token"),this._httpService.get("/api/user/logout"),this._router.navigateByUrl("/sign"),setTimeout(()=>{location.reload()},100)}updateAdmin(e){this.update(e,{name:"admin"})}deleteAdmin(e){this.delete(e,{name:"admin"})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{b as a};
