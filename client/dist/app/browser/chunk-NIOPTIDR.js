import{a as ot}from"./chunk-2TUBYUWN.js";import{a as j,k as w,n as Z,o as tt,p as et,r as nt}from"./chunk-FZ63LWPL.js";import{C as c,E as d,F as u,Ha as x,I as N,Ia as P,Ja as L,Ka as U,L as q,Pa as H,Sa as Y,T as h,Ta as G,Ua as Q,V as R,_ as g,a as O,b as A,da as J,ea as b,ha as z,hb as D,ja as y,ka as F,la as S,lb as X,ma as k,na as I,oa as f,pa as l,qa as p,ua as B,va as v,wa as _,xa as a,y as V,ya as W,za as K}from"./chunk-O6TSCDJI.js";var at=["*"],lt=(i,o,r,t,e,n,s,m,C)=>({_primary:i,_secondary:o,_success:r,_danger:t,_warning:e,_info:n,_light:s,_dark:m,_link:C}),it=(()=>{let o=class o{constructor(){this.type="primary",this.class="",this.disabled=!1,this.disableSubmit=!1,this.wClick=new b}clicked(){this.disabled||(typeof this.click=="function"&&this.click(),this.wClick.emit())}setDisabled(t){this.disabled=t}ngOnChanges(t){t.disabled&&(this.disabled=t.disabled.currentValue),t.class&&(this.class=t.class.currentValue),t.type&&(this.type=t.type.currentValue),t.disableSubmit&&(this.disableSubmit=t.disableSubmit.currentValue)}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=g({type:o,selectors:[["wbutton"]],inputs:{type:"type",class:"class",disabled:"disabled",disableSubmit:"disableSubmit",click:"click"},outputs:{wClick:"wClick"},features:[q],ngContentSelectors:at,decls:2,vars:16,consts:[[3,"click","ngClass","type","disabled"]],template:function(e,n){e&1&&(W(),l(0,"button",0),_("click",function(){return n.clicked()}),K(1),p()),e&2&&(x(H("w-btn",n.class?" "+n.class:"")),f("ngClass",Q(6,lt,[n.type==="primary",n.type==="secondary",n.type==="success",n.type==="danger",n.type==="warning",n.type==="info",n.type==="light",n.type==="dark",n.type==="link"]))("type",n.click||n.disableSubmit?"button":"submit")("disabled",n.disabled))},dependencies:[D],encapsulation:2});let i=o;return i})();function pt(i,o){if(i&1){let r=v();l(0,"wbutton",4),_("click",function(){let e=d(r).$implicit,n=a();return u(e.click(n.submition,n.close))}),P(1),p()}if(i&2){let r=o.$implicit;f("ngClass",r.class),h(),U(" ",r.label," ")}}var $=(()=>{let o=class o{constructor(){this._core=c(w),this.submit=t=>{},this.change=t=>{}}set(t){this._core.copy(t,this.submition),this._core.copy(t.data,this.submition.data)}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=g({type:o,selectors:[["ng-component"]],decls:5,vars:2,consts:[["formRef",""],[3,"wSubmit","wChange","config","submition"],[1,"btn-action","btn-action_w95p"],[1,"w-btn","_primary",3,"ngClass"],[1,"w-btn","_primary",3,"click","ngClass"]],template:function(e,n){if(e&1){let s=v();l(0,"wform",1,0),_("wSubmit",function(){return d(s),n.set(n.submition),n.submit(n.submition),u(n.close())})("wChange",function(){return d(s),n.set(n.submition),u(n.change(n.submition))}),p(),l(2,"div",2),k(3,pt,2,2,"wbutton",3,S),p()}e&2&&(f("config",n.form)("submition",n.submition),h(3),I(n.buttons))},dependencies:[E,it,D],styles:[".btn-action[_ngcontent-%COMP%]{padding:30px 0 0}.btn-action[_ngcontent-%COMP%]   .w-btn[_ngcontent-%COMP%]{width:100%;display:block}"]});let i=o;return i})();var st=(()=>{let o=class o{constructor(){this._http=c(tt)}get getDoc(){return this.doc}change(){this._http.post("/api/"+this.module+"/unique"+(this.field||""),this.doc).subscribe(t=>{this.doc[this.field]!==t&&(this.doc[this.field]=t)})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=g({type:o,selectors:[["app-modal-unique"]],decls:1,vars:2,consts:[[3,"wChange","config","submition"]],template:function(e,n){e&1&&(l(0,"wform",0),_("wChange",function(){return n.change()}),p()),e&2&&f("config",n.form)("submition",n.getDoc)},dependencies:[E],encapsulation:2});let i=o;return i})();var rt=(()=>{let o=class o extends et{constructor(){super({name:"form"}),this._core=c(w),this.appId=j.appId,this.customforms=[],this.get({query:this.appId?"appId="+this.appId:""}).subscribe(t=>this.customforms.push(...t)),this._core.on("customform_create").subscribe(t=>{this.customforms.push(t)}),this._core.on("customform_delete").subscribe(t=>{this.customforms.splice(this.customforms.findIndex(e=>e._id===t._id),1)})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=V({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var mt=(()=>{let o=class o{constructor(){this.componentFactoryResolver=c(R),this._translate=c(ot),this._cfs=c(rt),this.appRef=c(z),this._modal=c(nt),this._store=c(Z),this._core=c(w),this.injector=c(N),this.appId=j.appId,this._injectedComponent={},this.templateFields={},this.customTemplateFields={},this._templateComponent={},this.forms=[],this.formIds=[],this._store.getJson("formIds",t=>{Array.isArray(t)&&this.formIds.push(...t)})}getTemplateFields(t){return this.templateFields[t]||["Placeholder","Label"]}setTemplateFields(t,e,n={}){this.templateFields[t]=e,this.customTemplateFields[t]=O(O({},this.customTemplateFields[t]||{}),n)}getCustomTemplateFields(t){return this.customTemplateFields[t]||{}}injectComponent(t,e,n=["Placeholder","Label"],s={}){if(!this._injectedComponent[t]){this._injectedComponent[t]=!0,this.templateFields[t]=n,this.customTemplateFields[t]=s;let C=this.componentFactoryResolver.resolveComponentFactory(e).create(this.injector);this.appRef.attachView(C.hostView);let M=C.hostView.rootNodes[0];document.body.appendChild(M)}}addTemplateComponent(t,e){this._templateComponent[t]||(this._templateComponent[t]=e)}getTemplateComponent(t){return this._templateComponent[t]}getTemplateComponentsNames(){let t=[];for(let e in this._templateComponent)t.push(e);return t}translateForm(t){if(t.title){t.title=this._translate.translate(`Form_${t.formId}.${t.title}`,e=>{t.title=e});for(let e of t.components)for(let n of e.fields||[])this.translateFormComponent(t,n)}}translateFormComponent(t,e){let n=e.value;typeof n=="string"&&!e.skipTranslation&&(e.value=this._translate.translate(`Form_${t.formId}.${n}`,s=>{e.value=s}))}getDefaultForm(t,e=["name","description"]){return this.formIds.indexOf(t)===-1&&(this.formIds.push(t),this._store.setJson("formIds",this.formIds)),{id:t,components:e.map((s,m)=>({name:s.includes(".")?s.split(".")[1]:"Text",key:s,focused:!m,fields:[{name:"Placeholder",value:"Enter your "+s.split(".")[0]},{name:"Label",value:s.split(".")[0].capitalize()}]}))}}prepareForm(t){let e=t.formId+"";return this.formIds.indexOf(e)===-1&&(this.formIds.push(e),this._store.setJson("formIds",this.formIds)),t=t||this.getDefaultForm(e),t.formId=e,this._core.onComplete("form_loaded").then(()=>{let n=this._cfs.customforms.filter(s=>s.active&&s.formId===t.formId);for(let s of n){t.title=t.title||s.name,t.class=t.class||s.class;for(let m of s.components)m.key=m.key?.startsWith("data.")?m.key:"data."+m.key,t.components.push(m)}this.translateForm(t)}),t}getForm(t,e){return console.warn("This function is deprecated"),e&&this.forms.map(n=>n.formId).indexOf(e?.formId)===-1&&this.forms.push(e),this.formIds.indexOf(t)===-1&&(this.formIds.push(t),this._store.setJson("formIds",this.formIds)),e=e||this.forms.find(n=>n.formId===t),e=e||this.getDefaultForm(t),e.formId=t,this._core.onComplete("form_loaded").then(()=>{let n=this._cfs.customforms.filter(s=>s.active&&s.formId===e.formId);for(let s of n){e.title=e.title||s.name,e.class=e.class||s.class;for(let m of s.components)m.key=m.key?.startsWith("data.")?m.key:"data."+m.key,e.components.push(m)}this.translateForm(e)}),e}modal(t,e=[],n={data:{}},s=C=>{},m={}){return new Promise(C=>{this._modal.show(A(O({},m),{component:$,class:"forms_modal",size:"big",form:t,buttons:Array.isArray(e)?e:[e],submition:n,onClose:function(){C(this.submition)},submit:M=>{C(M)},change:M=>{typeof s=="function"&&s(M)}}))})}modalDocs(t){return new Promise(e=>{let n={docs:JSON.stringify(t.length?t:[],null,4)};this._modal.show({component:$,class:"forms_modal",size:"big",submition:n,form:{title:"Modify content of documents",components:[{name:"Code",key:"docs",fields:[{name:"Placeholder",value:"fill content of documents"}]}]},onClose:function(){let s=n.docs?JSON.parse(n.docs):[];e(s)},submit:()=>{let s=n.docs?JSON.parse(n.docs):[];e(s)}})})}modalUnique(t,e,n,s="",m=()=>{}){this._modal.show({component:st,form:this.getDefaultForm("unique",[e+(s?"."+s:"")]),module:t,field:e,doc:n,class:"forms_modal",onClose:m})}getComponent(t,e){return this._getComponent(t.components,e)||{}}getField(t,e,n){let s=this.getComponent(t,e);if(!s)return null;for(let m of s?.fields||[])if(m.name===n)return m;return null}setValue(t,e,n,s){let m=this.getField(t,e,n);m&&(m.value=s,this.getComponent(t,e)?.resetFields?.())}_getComponent(t,e){for(let n of t){if(n.key===e)return n;if(n.components){let s=this._getComponent(n.components,e);if(s)return s}}return null}_addCustomComponents(t){}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=V({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var dt=(i,o,r,t,e,n,s,m)=>({field:i,config:o,component:r,key:t,submition:e,wSubmit:n,wChange:s,wClick:m}),ut=i=>({$implicit:i});function ft(i,o){if(i&1){let r=v();l(0,"form-component",4),_("wSubmit",function(){d(r);let e=a(3);return u(e.wSubmit.emit(e.submition))})("wChange",function(){d(r);let e=a(3);return u(e.wChange.emit())})("wClick",function(){d(r);let e=a(3);return u(e.wClick.emit())}),p()}if(i&2){let r=a(),t=r.$implicit,e=r.$index,n=a(2);x(n.config.formId+"_"+n.index+"_"+e+" "+(n.component.class||"")),f("component",t)("submition",n.submition)("config",n.config)("index",n.index+"_"+e)}}function _t(i,o){if(i&1&&y(0,ft,1,6,"form-component",3),i&2){let r=a(2);F(r.component.hidden?-1:0)}}function ht(i,o){if(i&1&&(l(0,"div",2),k(1,_t,1,1,null,null,S),p()),i&2){let r=a();x(r.component.class||""),h(),I(r.component.components)}}function Ct(i,o){i&1&&B(0)}function gt(i,o){if(i&1&&(l(0,"div",1),J(1,Ct,1,0,"ng-container",5),p()),i&2){let r=a();h(),f("ngTemplateOutlet",r.template)("ngTemplateOutletContext",Y(11,ut,G(2,dt,r.field,r.config,r.component,r.localKey,r.localSubmition,r.submit.bind(r),r.change.bind(r),r.click.bind(r))))}}var ct=(()=>{let o=class o{constructor(){this._form=c(mt),this.submition={},this.wSubmit=new b,this.wChange=new b,this.wClick=new b,this.field={}}submit(){this.wSubmit.emit(this.submition)}change(){this.wChange.emit(this.submition)}click(){this.wClick.emit(this.submition)}get hasComponents(){return Array.isArray(this.component.components)}get template(){return this._form.getTemplateComponent(this.component.name)}ngOnInit(){this.component.resetFields=this._resetFields.bind(this),this._resetFields(),this.localSubmition=this.submition;let t=(this.component.key||"")?.split(".");for(;t.length>1;){let e=t.shift();if(e.endsWith("[]")){e=e.replace("[]","");let n=this._getIndex();for(this.localSubmition[e]=this.localSubmition[e]||[];n+1>this.localSubmition[e].length;)this.localSubmition[e].push({});this.localSubmition=this.localSubmition[e][n]}else this.localSubmition=this.localSubmition[e]||{}}this.localKey=t[0]}_getIndex(t=this.config.components){for(let e of t)if(e.components){if(this._getIndex(e.components)>=0){for(let s=0;s<e.components.length;s++)for(let m of e.components[s].components)if(m===this.component)return s}if(e?.components?.indexOf(this.component)>=0)return e.components.indexOf(this.component)}return-1}_resetFields(){if(Array.isArray(this.component.fields))for(let t of this.component.fields)this.field[t.name]=t.value}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=g({type:o,selectors:[["form-component"]],inputs:{index:"index",config:"config",component:"component",submition:"submition"},outputs:{wSubmit:"wSubmit",wChange:"wChange",wClick:"wClick"},decls:2,vars:2,consts:[[1,"form-components-container",3,"class"],[1,"form-container"],[1,"form-components-container"],[1,"w-forms__component",3,"class","component","submition","config","index"],[1,"w-forms__component",3,"wSubmit","wChange","wClick","component","submition","config","index"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(y(0,ht,3,2,"div",0),y(1,gt,2,13,"div",1)),e&2&&(F(n.hasComponents?0:-1),h(),F(n.component.name&&n.template&&(!n.component.key||n.localKey&&n.localSubmition)?1:-1))},dependencies:[o,X],styles:["[_nghost-%COMP%]{position:relative}.w-forms[_ngcontent-%COMP%]{position:relative;padding:0!important;background-color:red}.w-forms__component[_ngcontent-%COMP%]{align-items:end;margin:0 0 10px}.w-forms__level[_ngcontent-%COMP%]{top:3px;right:5px;position:absolute;display:inline-block;color:var(--c-text-secondary);font-size:22px;line-height:calc(var(--fs) + 4px);letter-spacing:var(--letter-spacing);transition:var(--transition)}.w-forms__level._sky[_ngcontent-%COMP%]{color:var(--c-info)}.w-forms__level._orange[_ngcontent-%COMP%]{color:var(--c-warn)}.w-forms__level._green[_ngcontent-%COMP%]{color:var(--c-success)}.w-forms__input[_ngcontent-%COMP%]{padding-right:35px}.w-forms__input-block[_ngcontent-%COMP%]{position:relative}.w-forms__toggle[_ngcontent-%COMP%]{display:flex;position:absolute;right:10px;bottom:10px;color:var(--c-placeholder);transform:translateY(-50%);cursor:pointer}.w-forms__toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:21px}.w-forms[_ngcontent-%COMP%]   .icon-visibility[_ngcontent-%COMP%]{color:var(--c-primary)}"]});let i=o;return i})();function bt(i,o){if(i&1&&(l(0,"h1",1),P(1),p()),i&2){let r=a();h(),L(r.config.title)}}function wt(i,o){if(i&1){let r=v();l(0,"form-component",4),_("wSubmit",function(){d(r);let e=a(2);return u(e.onSubmit())})("wChange",function(){d(r);let e=a(2);return u(e.onChange())})("wClick",function(){d(r);let e=a(2);return u(e.onClick())}),p()}if(i&2){let r=a(),t=r.$implicit,e=r.$index,n=a();x(n.config.formId+"_"+e+" "+(t.class||"")+" "+n.config.formId),f("component",t)("submition",n.submition)("config",n.config)("index",""+e)}}function yt(i,o){if(i&1&&y(0,wt,1,6,"form-component",3),i&2){let r=o.$implicit;F(r.hidden?-1:0)}}var E=(()=>{let o=class o{constructor(){this._core=c(w),this.submition={},this.wChange=new b,this.wSubmit=new b}ngAfterViewInit(){this.submition.data=this.submition.data||{}}component(t,e=this.config.components){for(let n of e){if(n.key===t)return n;if(n.components?.length){let s=this.component(t,n.components);if(s)return s}}return!1}onSubmit(){this._core.afterWhile(this,()=>{for(let t of this.config.components)if(t.key&&t.required&&(t.valid&&!t.valid()||!t.valid&&!this.submition[t.key])){typeof t.focus=="function"&&t.focus();return}this.wSubmit.emit(this.submition)})}onChange(){this._core.afterWhile(this,()=>{this.wChange.emit(this.submition)})}onClick(){}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=g({type:o,selectors:[["wform"]],inputs:{config:"config",submition:"submition"},outputs:{wChange:"wChange",wSubmit:"wSubmit"},decls:5,vars:1,consts:[[1,"w-forms"],[1,"w-forms__title"],[3,"ngSubmit"],[1,"w-forms__component",3,"class","component","submition","config","index"],[1,"w-forms__component",3,"wSubmit","wChange","wClick","component","submition","config","index"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,bt,2,1,"h1",1),l(2,"form",2),_("ngSubmit",function(){return n.onSubmit()}),k(3,yt,1,1,null,null,S),p()()),e&2&&(h(),F(n.config.title?1:-1),h(2),I(n.config.components))},dependencies:[ct],encapsulation:2});let i=o;return i})();export{it as a,E as b,rt as c,mt as d};
