import{$a as ue,$b as Kn,A as w,Aa as L,B as Ye,Ba as S,C as x,Ca as E,Cb as ee,D as O,Db as Bn,E as l,Ea as ce,F as vn,Fa as ke,Fb as et,Ga as En,Gb as Vt,H as bn,I as Ve,J as D,Ja as kn,K as M,Ka as U,Kb as Ln,La as In,Ma as N,N as j,Na as de,Nb as G,O as Ae,Oa as v,P as Z,Pa as Fn,Q as Je,Qa as Nn,Qb as fe,R as f,Rb as Un,S as A,Sb as $n,T as m,Tb as Gn,U as wn,Ub as Hn,V as Cn,Vb as Wn,W as q,Wb as qn,X as Dn,Y as B,Za as xn,_a as $,_b as zn,a as vt,aa as C,ab as On,bb as Tn,bc as Yn,c as V,d as We,da as wt,ea as k,f as qe,fa as Mn,fb as Pn,g as dn,ga as I,gb as Mt,h as K,ha as Ze,hb as St,i as re,ia as F,j as un,jb as Xe,k as ze,ka as Ee,kb as Qe,l as hn,lb as Ie,m as se,mb as he,n as fn,na as Ct,nb as Rn,p as mn,pa as Dt,pb as jn,q as Ke,r as pn,ra as Sn,s as Me,t as gn,ta as Vn,u as _n,ua as X,ub as h,v as yn,va as Q,vb as Fe,w as oe,wb as T,x as Se,xa as An,xb as p,y as b,ya as ae,z as bt,za as le}from"./chunk-3BU3K6CC.js";import{a as d,b as g,e as y}from"./chunk-6MDQTQU3.js";function Ds(i){i||(i=l(Z));let t=new V(e=>{if(i.destroyed){e.next();return}return i.onDestroy(e.next.bind(e))});return e=>e.pipe(Se(t))}function At(i,t){let e=t?.injector??l(j),n=new qe(1),r=A(()=>{let s;try{s=i()}catch(o){m(()=>n.error(o));return}m(()=>n.next(s))},{injector:e,manualCleanup:!0});return e.get(Z).onDestroy(()=>{r.destroy(),n.complete()}),n.asObservable()}var ii=(()=>{class i{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,n){this._renderer=e,this._elementRef=n}setProperty(e,n){this._renderer.setProperty(this._elementRef.nativeElement,e,n)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(n){return new(n||i)(k(wt),k(q))};static \u0275dir=F({type:i})}return i})(),Hi=(()=>{class i extends ii{static \u0275fac=(()=>{let e;return function(r){return(e||(e=Cn(i)))(r||i)}})();static \u0275dir=F({type:i,features:[Ee]})}return i})(),ot=new x("");var Wi={provide:ot,useExisting:bt(()=>ri),multi:!0};function qi(){let i=Vt()?Vt().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var zi=new x(""),ri=(()=>{class i extends ii{_compositionMode;_composing=!1;constructor(e,n,r){super(e,n),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!qi())}writeValue(e){let n=e??"";this.setProperty("value",n)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(n){return new(n||i)(k(wt),k(q),k(zi,8))};static \u0275dir=F({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){n&1&&N("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},standalone:!1,features:[Ie([Wi]),Ee]})}return i})();function Nt(i){return i==null||xt(i)===0}function xt(i){return i==null?null:Array.isArray(i)||typeof i=="string"?i.length:i instanceof Set?i.size:null}var Ki=new x(""),Yi=new x(""),Ji=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,nt=class{static min(t){return Zi(t)}static max(t){return Xi(t)}static required(t){return Qi(t)}static requiredTrue(t){return er(t)}static email(t){return tr(t)}static minLength(t){return nr(t)}static maxLength(t){return ir(t)}static pattern(t){return rr(t)}static nullValidator(t){return si()}static compose(t){return ui(t)}static composeAsync(t){return fi(t)}};function Zi(i){return t=>{if(t.value==null||i==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e<i?{min:{min:i,actual:t.value}}:null}}function Xi(i){return t=>{if(t.value==null||i==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e>i?{max:{max:i,actual:t.value}}:null}}function Qi(i){return Nt(i.value)?{required:!0}:null}function er(i){return i.value===!0?null:{required:!0}}function tr(i){return Nt(i.value)||Ji.test(i.value)?null:{email:!0}}function nr(i){return t=>{let e=t.value?.length??xt(t.value);return e===null||e===0?null:e<i?{minlength:{requiredLength:i,actualLength:e}}:null}}function ir(i){return t=>{let e=t.value?.length??xt(t.value);return e!==null&&e>i?{maxlength:{requiredLength:i,actualLength:e}}:null}}function rr(i){if(!i)return si;let t,e;return typeof i=="string"?(e="",i.charAt(0)!=="^"&&(e+="^"),e+=i,i.charAt(i.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=i.toString(),t=i),n=>{if(Nt(n.value))return null;let r=n.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}function si(i){return null}function oi(i){return i!=null}function ai(i){return Ct(i)?K(i):i}function li(i){let t={};return i.forEach(e=>{t=e!=null?d(d({},t),e):t}),Object.keys(t).length===0?null:t}function ci(i,t){return t.map(e=>e(i))}function sr(i){return!i.validate}function di(i){return i.map(t=>sr(t)?t:e=>t.validate(e))}function ui(i){if(!i)return null;let t=i.filter(oi);return t.length==0?null:function(e){return li(ci(e,t))}}function hi(i){return i!=null?ui(di(i)):null}function fi(i){if(!i)return null;let t=i.filter(oi);return t.length==0?null:function(e){let n=ci(e,t).map(ai);return fn(n).pipe(ze(li))}}function mi(i){return i!=null?fi(di(i)):null}function Jn(i,t){return i===null?[t]:Array.isArray(i)?[...i,t]:[i,t]}function or(i){return i._rawValidators}function ar(i){return i._rawAsyncValidators}function Et(i){return i?Array.isArray(i)?i:[i]:[]}function it(i,t){return Array.isArray(i)?i.includes(t):i===t}function Zn(i,t){let e=Et(t);return Et(i).forEach(r=>{it(e,r)||e.push(r)}),e}function Xn(i,t){return Et(t).filter(e=>!it(i,e))}var rt=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=hi(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=mi(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control?.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},kt=class extends rt{name;get formDirective(){return null}get path(){return null}},te=class extends rt{_parent=null;name=null;valueAccessor=null},It=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}};var Hs=(()=>{class i extends It{constructor(e){super(e)}static \u0275fac=function(n){return new(n||i)(k(te,2))};static \u0275dir=F({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){n&2&&xn("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[Ee]})}return i})();var Ne="VALID",tt="INVALID",me="PENDING",xe="DISABLED",ne=class{},st=class extends ne{value;source;constructor(t,e){super(),this.value=t,this.source=e}},Oe=class extends ne{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}},Te=class extends ne{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}},pe=class extends ne{status;source;constructor(t,e){super(),this.status=t,this.source=e}};var Ft=class extends ne{source;constructor(t){super(),this.source=t}};function lr(i){return(at(i)?i.validators:i)||null}function cr(i){return Array.isArray(i)?hi(i):i||null}function dr(i,t){return(at(t)?t.asyncValidators:i)||null}function ur(i){return Array.isArray(i)?mi(i):i||null}function at(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}var Pe=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return m(this.statusReactive)}set status(t){m(()=>this.statusReactive.set(t))}_status=h(()=>this.statusReactive());statusReactive=f(void 0);get valid(){return this.status===Ne}get invalid(){return this.status===tt}get pending(){return this.status==me}get disabled(){return this.status===xe}get enabled(){return this.status!==xe}errors;get pristine(){return m(this.pristineReactive)}set pristine(t){m(()=>this.pristineReactive.set(t))}_pristine=h(()=>this.pristineReactive());pristineReactive=f(!0);get dirty(){return!this.pristine}get touched(){return m(this.touchedReactive)}set touched(t){m(()=>this.touchedReactive.set(t))}_touched=h(()=>this.touchedReactive());touchedReactive=f(!1);get untouched(){return!this.touched}_events=new We;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(Zn(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(Zn(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(Xn(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(Xn(t,this._rawAsyncValidators))}hasValidator(t){return it(this._rawValidators,t)}hasAsyncValidator(t){return it(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let n=t.sourceControl??this;t.onlySelf||this._parent?.markAsTouched(g(d({},t),{sourceControl:n})),e&&t.emitEvent!==!1&&this._events.next(new Te(!0,n))}markAllAsDirty(t={}){this.markAsDirty({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsDirty(t))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=t.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:n})}),t.onlySelf||this._parent?._updateTouched(t,n),e&&t.emitEvent!==!1&&this._events.next(new Te(!1,n))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let n=t.sourceControl??this;t.onlySelf||this._parent?.markAsDirty(g(d({},t),{sourceControl:n})),e&&t.emitEvent!==!1&&this._events.next(new Oe(!1,n))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=t.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),t.onlySelf||this._parent?._updatePristine(t,n),e&&t.emitEvent!==!1&&this._events.next(new Oe(!0,n))}markAsPending(t={}){this.status=me;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new pe(this.status,e)),this.statusChanges.emit(this.status)),t.onlySelf||this._parent?.markAsPending(g(d({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=xe,this.errors=null,this._forEachChild(r=>{r.disable(g(d({},t),{onlySelf:!0}))}),this._updateValue();let n=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new st(this.value,n)),this._events.next(new pe(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(g(d({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Ne,this._forEachChild(n=>{n.enable(g(d({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(g(d({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t,e){t.onlySelf||(this._parent?.updateValueAndValidity(t),t.skipPristineCheck||this._parent?._updatePristine({},e),this._parent?._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ne||this.status===me)&&this._runAsyncValidator(n,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new st(this.value,e)),this._events.next(new pe(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),t.onlySelf||this._parent?.updateValueAndValidity(g(d({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?xe:Ne}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=me,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1,shouldHaveEmitted:t!==!1};let n=ai(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((n,r)=>n&&n._find(r),this)}getError(t,e){let n=e?this.get(e):this;return n?.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,n){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||n)&&this._events.next(new pe(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,n)}_initObservables(){this.valueChanges=new Je,this.statusChanges=new Je}_calculateStatus(){return this._allControlsDisabled()?xe:this.errors?tt:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(me)?me:this._anyControlsHaveStatus(tt)?tt:Ne}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let n=!this._anyControlsDirty(),r=this.pristine!==n;this.pristine=n,t.onlySelf||this._parent?._updatePristine(t,e),r&&this._events.next(new Oe(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new Te(this.touched,e)),t.onlySelf||this._parent?._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){at(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!!this._parent?.dirty&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=cr(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=ur(this._rawAsyncValidators)}};var pi=new x("",{factory:()=>Ot}),Ot="always";function hr(i,t){return[...t.path,i]}function fr(i,t,e=Ot){pr(i,t),t.valueAccessor.writeValue(i.value),(i.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(i.disabled),gr(i,t),yr(i,t),_r(i,t),mr(i,t)}function Qn(i,t){i.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function mr(i,t){if(t.valueAccessor.setDisabledState){let e=n=>{t.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(e),t._registerOnDestroy(()=>{i._unregisterOnDisabledChange(e)})}}function pr(i,t){let e=or(i);t.validator!==null?i.setValidators(Jn(e,t.validator)):typeof e=="function"&&i.setValidators([e]);let n=ar(i);t.asyncValidator!==null?i.setAsyncValidators(Jn(n,t.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let r=()=>i.updateValueAndValidity();Qn(t._rawValidators,r),Qn(t._rawAsyncValidators,r)}function gr(i,t){t.valueAccessor.registerOnChange(e=>{i._pendingValue=e,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&gi(i,t)})}function _r(i,t){t.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&gi(i,t),i.updateOn!=="submit"&&i.markAsTouched()})}function gi(i,t){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function yr(i,t){let e=(n,r)=>{t.valueAccessor.writeValue(n),r&&t.viewToModelUpdate(n)};i.registerOnChange(e),t._registerOnDestroy(()=>{i._unregisterOnChange(e)})}function vr(i,t){if(!i.hasOwnProperty("model"))return!1;let e=i.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function br(i){return Object.getPrototypeOf(i.constructor)===Hi}function wr(i,t){if(!t)return null;Array.isArray(t);let e,n,r;return t.forEach(s=>{s.constructor===ri?e=s:br(s)?n=s:r=s}),r||n||e||null}function ei(i,t){let e=i.indexOf(t);e>-1&&i.splice(e,1)}function ti(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var Cr=class extends Pe{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,n){super(lr(e),dr(n,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),at(e)&&(e.nonNullable||e.initialValueIsDefault)&&(ti(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),e.overwriteDefaultValue&&(this.defaultValue=this.value),this._pendingChange=!1,e?.emitEvent!==!1&&this._events.next(new Ft(this))}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){ei(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){ei(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){ti(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var Dr={provide:te,useExisting:bt(()=>Mr)},ni=Promise.resolve(),Mr=(()=>{class i extends te{_changeDetectorRef;callSetDisabledState;control=new Cr;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Je;constructor(e,n,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this._parent=e,this._setValidators(n),this._setAsyncValidators(r),this.valueAccessor=wr(this,s)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let n=e.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),vr(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective?.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){fr(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){ni.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let n=e.isDisabled.currentValue,r=n!==0&&Bn(n);ni.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?hr(e,this._parent):[e]}static \u0275fac=function(n){return new(n||i)(k(kt,9),k(Ki,10),k(Yi,10),k(ot,10),k(ee,8),k(pi,8))};static \u0275dir=F({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Ie([Dr]),Ee,wn]})}return i})();var Sr=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ze({type:i});static \u0275inj=Ye({})}return i})();var qs=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:pi,useValue:e.callSetDisabledState??Ot}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ze({type:i});static \u0275inj=Ye({imports:[Sr]})}return i})();var Re=new x("config"),Tt={store:{prefix:"waStore"},meta:{useTitleSuffix:!1,defaults:{links:{}}},socket:!1,http:{url:"",headers:{}}},Vr={headers:{},url:""},Ar={endpoints:["https://api.webart.work/status","https://www.google.com/generate_204","https://www.gstatic.com/generate_204","https://www.cloudflare.com/cdn-cgi/trace"],intervalMs:3e4,timeoutMs:2500,goodLatencyMs:300,maxConsecutiveFails:3};String.prototype.capitalize||(String.prototype.capitalize=function(){return this.length>0?this.charAt(0).toUpperCase()+this.slice(1).toLowerCase():""});var R=i=>typeof i<"u",Er=(()=>{class i{constructor(e,n,r,s,o){this._config=e,this._router=n,this._activatedRoute=r,this._meta=s,this._titleService=o,this._isBrowser=G(l(B)),this._managedTagSelectors=new Set,this._managedLinkRels=new Set,this._doc=l(Ae),this._config=this._config||Tt,this._metaConfig=this._config.meta||{},(!R(this._metaConfig.applyFromRoutes)||this._metaConfig.applyFromRoutes)&&this._router.events.pipe(Ke(c=>c instanceof zn)).subscribe(()=>{let c=this._readDeepestRouteMeta();c?this.applyMeta(c):this.reset()})}setDefaults(e){this._metaConfig.defaults=d(d({},this._metaConfig.defaults||{}),e)}applyMeta(e={}){if(e.disableUpdate)return;this._removeManagedTags();let n=this._metaConfig.defaults||{},r=this._resolveTitle(e,n),s=this._resolveValue(e.description,n.description),o=this._resolveValue(e.image,n.image),a=this._resolveRobots(e,n);this._setTitleTriplet(r),this._setDescriptionTriplet(s),this._setImageTriplet(o),R(a)&&this._updateTag("robots",a,"name")}reset(){this.applyMeta({})}setLink(e){if(this._isBrowser&&!(!e||!Object.keys(e).length))for(let n of Object.keys(e)){let r=e[n],s=Array.from(this._doc.head.querySelectorAll(`link[rel="${n}"]`)),o=s[0];if(!o)o=this._doc.createElement("link"),o.setAttribute("rel",n),this._doc.head.appendChild(o);else if(s.length>1)for(let a=1;a<s.length;a++)s[a].remove();o.setAttribute("href",r),this._managedLinkRels.add(n)}}resetLinks(){if(this._isBrowser){for(let e of this._managedLinkRels)Array.from(this._doc.head.querySelectorAll(`link[rel="${e}"]`)).forEach(r=>r.remove());this._managedLinkRels.clear()}}_readDeepestRouteMeta(){let e=this._activatedRoute;for(;e?.firstChild;)e=e.firstChild;let n=e?.snapshot?.data;return n&&n.meta||null}_resolveTitle(e,n){let r=this._resolveValue(e.title,n.title)||"";if(this._metaConfig.useTitleSuffix){let s=R(e.titleSuffix)?e.titleSuffix:n.titleSuffix;r+=s||""}return r}_resolveRobots(e,n){if(R(e.robots))return(e.robots||"")+"";if(R(n.robots))return(n.robots||"")+"";let r=R(e.index)?e.index:n.index;if(R(r))return r?"index, follow":"noindex, follow"}_resolveValue(e,n){if(R(e))return(e||"")+"";if(R(n))return(n||"")+""}_setTitleTriplet(e){this._titleService.setTitle(e),this._updateTag("og:title",e,"property"),this._updateTag("twitter:title",e,"name"),this._updateTag("name",e,"itemprop")}_setDescriptionTriplet(e){if(!R(e))return;let n=e;this._updateTag("description",n,"name"),this._updateTag("og:description",n,"property"),this._updateTag("twitter:description",n,"name"),this._updateTag("description",n,"itemprop")}_setImageTriplet(e){if(!R(e))return;let n=e;this._updateTag("og:image",n,"property"),this._updateTag("twitter:image:src",n,"name"),this._updateTag("image",n,"itemprop")}_updateTag(e,n,r){let s=r==="itemprop"?`itemprop="${e}"`:`${r}="${e}"`,o=r==="itemprop"?{itemprop:e,content:n}:{[r]:e,content:n};this._meta.updateTag(o,s),this._managedTagSelectors.add(s)}_removeManagedTags(){for(let e of this._managedTagSelectors)this._meta.removeTag(e);this._managedTagSelectors.clear()}static{this.\u0275fac=function(n){return new(n||i)(O(Re,8),O(Yn),O(Kn),O(Wn),O(qn))}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),po=(()=>{class i{constructor(e){this._metaService=e}canActivate(e){let n=e.data&&e.data.meta||null;return n?this._metaService.applyMeta(n):this._metaService.reset(),!0}static{this.\u0275fac=function(n){return new(n||i)(O(Er))}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),_e=(()=>{class i{constructor(){if(this._platformId=l(B),this._isBrowser=G(this._platformId),this._destroyRef=l(Z),this.deviceID="",this._afterWhile={},this.device="",this.viewport=f("desktop"),this.isViewportMobile=h(()=>this.viewport()==="mobile"),this.isViewportTablet=h(()=>this.viewport()==="tablet"),this.isViewportDesktop=h(()=>this.viewport()==="desktop"),this.version="1.0.0",this.appVersion="",this.dateVersion="",this._locked={},this._unlockResolvers={},this._isBrowser){let e=localStorage.getItem("deviceID");this.deviceID=e||(typeof crypto?.randomUUID=="function"?crypto.randomUUID():this.UUID()),localStorage.setItem("deviceID",this.deviceID),this.detectDevice(),this.detectViewport()}else this.deviceID=this.UUID()}UUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}ota(e,n=!1){if(Array.isArray(e))return e;if(typeof e!="object"||e===null)return[];let r=[];for(let s in e)e.hasOwnProperty(s)&&(e[s]||typeof e[s]=="number"||typeof e[s]=="boolean")&&(n?r.push(s):r.push(e[s]));return r}splice(e,n,r="_id"){if(!Array.isArray(e)||!Array.isArray(n))return n;let s=new Set(e.map(o=>o[r]));return n.filter(o=>!s.has(o[r]))}ids2id(...e){return e.sort((n,r)=>Number(n.toString().substring(0,8))>Number(r.toString().substring(0,8))?1:-1),e.join()}afterWhile(e,n,r=1e3){typeof e=="function"&&(n=e,e="common"),typeof n=="function"&&typeof r=="number"&&(typeof e=="string"?(clearTimeout(this._afterWhile[e]),this._afterWhile[e]=setTimeout(n,r)):typeof e=="object"?(clearTimeout(e.__afterWhile),e.__afterWhile=setTimeout(n,r)):console.warn("badly configured after while"))}copy(e,n){for(let r in e)typeof e[r]!="object"||e[r]instanceof Date||Array.isArray(e[r])||e[r]===null?n[r]=e[r]:((typeof n[r]!="object"||n[r]instanceof Date||Array.isArray(n[r])||n[r]===null)&&(n[r]={}),this.copy(e[r],n[r]))}detectDevice(){if(!this._isBrowser)return;let e=navigator.userAgent||navigator.vendor||window.opera;/windows phone/i.test(e)?this.device="Windows Phone":/android/i.test(e)?this.device="Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?this.device="iOS":this.device="Web"}isMobile(){return this.device==="Windows Phone"||this.device==="Android"||this.device==="iOS"}isTablet(){return this._isBrowser?this.device==="iOS"&&/iPad/.test(navigator.userAgent):!1}isWeb(){return this.device==="Web"}isAndroid(){return this.device==="Android"}isIos(){return this.device==="iOS"}detectViewport(){if(!this._isBrowser)return;let e=window.matchMedia("(max-width: 767.98px)"),n=window.matchMedia("(min-width: 768px) and (max-width: 1023.98px)"),r=window.matchMedia("(min-width: 1024px)"),s=()=>e.matches?this.viewport.set("mobile"):n.matches?this.viewport.set("tablet"):this.viewport.set("desktop");s(),e.addEventListener("change",s),n.addEventListener("change",s),r.addEventListener("change",s),this._destroyRef.onDestroy(()=>{e.removeEventListener("change",s),n.removeEventListener("change",s),r.removeEventListener("change",s)})}setVersion(){this.version=this.appVersion||"",this.version+=this.version&&this.dateVersion?" ":"",this.version+=this.dateVersion||""}setAppVersion(e){this.appVersion=e,this.setVersion()}setDateVersion(e){this.dateVersion=e,this.setVersion()}lock(e){this._locked[e]=!0,this._unlockResolvers[e]||(this._unlockResolvers[e]=[])}unlock(e){this._locked[e]=!1,this._unlockResolvers[e]&&(this._unlockResolvers[e].forEach(n=>n()),this._unlockResolvers[e]=[])}onUnlock(e){return this._locked[e]?new Promise(n=>{this._unlockResolvers[e]||(this._unlockResolvers[e]=[]),this._unlockResolvers[e].push(n)}):Promise.resolve()}locked(e){return!!this._locked[e]}toSignal(e,n={}){if(Object.keys(n).length){let r={};for(let s in n)r[s]=f(n[s](e));return f(d(d({},e),r))}else return f(e)}toSignalsArray(e,n={}){return e.map(r=>this.toSignal(r,n))}pushSignal(e,n,r={}){e.push(this.toSignal(n,r))}removeSignalByField(e,n,r="_id"){let s=e.findIndex(o=>o()[r]===n);s>-1&&e.splice(s,1)}trackBySignalField(e){return(n,r)=>r()[e]}findSignalByField(e,n,r="_id"){return e.find(s=>s()[r]===n)}updateSignalByField(e,n,r,s){let o=this.findSignalByField(e,n,s);o&&o.update(r)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),_i=class{constructor(t,e,n,r=""){this.documents=f([]),this.page=1,this.__core=l(_e),this.__cdr=l(ee),this.localDocumentsFilter=()=>!0,this.updatableFields=["_id","name","description","data"],this.configType="server",this.perPage=20,this._module="";let s=t;this.__formService=e,this.form=s,this.crudService=n,this._module=r}setDocuments(t=this.page,e=""){return new Promise(n=>{this.configType==="server"?(this.page=t,this.__core.afterWhile(this,()=>{this.crudService.get({page:t,query:e},this.getOptions()).subscribe(r=>{this.documents.update(()=>(r||[]).map(s=>this.crudService.getSignal(s))),n(),this.__cdr.markForCheck()})},250)):(this.documents.update(()=>this.crudService.getDocs().filter(this.localDocumentsFilter).map(r=>this.crudService.getSignal(r))),this.crudService.loaded.pipe(Me(1)).subscribe(()=>{n(),this.__cdr.markForCheck()}))})}preCreate(t){delete t.__creating}allowCreate(){return!0}allowMutate(){return!0}allowUrl(){return!0}allowSort(){return!1}getOptions(){return{}}bulkManagement(t=!0){return()=>{this.__formService.modalDocs(t?[]:this.documents().map(e=>Object.fromEntries(this.updatableFields.map(n=>[n,e()[n]])))).then(e=>y(this,null,function*(){if(t)for(let n of e)this.preCreate(n),yield re(this.crudService.create(n));else{for(let n of this.documents())e.find(r=>r._id===n()._id)||(yield re(this.crudService.delete(n())));for(let n of e){let r=this.documents().find(s=>s()._id===n._id);r?(r.update(s=>(this.__core.copy(n,s),s)),yield re(this.crudService.update(r()))):(this.preCreate(n),yield re(this.crudService.create(n)))}}this.setDocuments()}))}}create(){this.__formService.modal(this.form,{label:"Create",click:(t,e)=>y(this,null,function*(){e(),this.preCreate(t),yield re(this.crudService.create(t)),this.setDocuments()})},{data:{}},()=>{},{resetOnSubmit:!0})}update(t){this.__formService.modal(this.form,{label:"Update",click:(e,n)=>{n(),this.__core.copy(e,t),this.crudService.update(t),this.__cdr.markForCheck()}},t)}delete(t){return y(this,null,function*(){this.crudService.delete(t).subscribe(()=>{this.setDocuments()})})}mutateUrl(t){this.__formService.modalUnique(this._module,"url",t)}moveUp(t){let e=this.documents().findIndex(n=>n()._id===t._id);e&&this.documents.update(n=>(n.splice(e,1),n.splice(e-1,0,this.crudService.getSignal(t)),n));for(let n=0;n<this.documents().length;n++)this.documents()[n]().order!==n&&(this.documents()[n]().order=n,this.crudService.update(this.documents()[n]()));this.__cdr.markForCheck()}getConfig(){let t={create:this.allowCreate()?()=>{this.create()}:null,update:this.allowMutate()?e=>{this.update(e)}:null,delete:this.allowMutate()?e=>{this.delete(e)}:null,buttons:[],headerButtons:[],allDocs:!0};return this.allowUrl()&&t.buttons.push({icon:"cloud_download",click:e=>{this.mutateUrl(e)}}),this.allowSort()&&t.buttons.push({icon:"arrow_upward",click:e=>{this.moveUp(e)}}),this.allowCreate()&&t.headerButtons.push({icon:"playlist_add",click:this.bulkManagement(),class:"playlist"}),this.allowMutate()&&t.headerButtons.push({icon:"edit_note",click:this.bulkManagement(!1),class:"edit"}),this.configType==="server"?g(d({},t),{paginate:this.setDocuments.bind(this),perPage:this.perPage,setPerPage:this.crudService.setPerPage?.bind(this.crudService),allDocs:!1}):t}},go=(()=>{class i{constructor(){this.clickOutside=T(),this._host=l(q),this._cdr=l(ee),this._dref=l(Z),this._doc=l(Ae),this._isBrowser=G(l(B)),this._handler=e=>{this._host.nativeElement.contains(e.target)||(this.clickOutside.emit(e),this._cdr.markForCheck())},this._isBrowser&&this._doc.addEventListener("pointerdown",this._handler,!0),this._dref.onDestroy(()=>this._doc.removeEventListener("pointerdown",this._handler,!0))}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275dir=F({type:i,selectors:[["","clickOutside",""]],outputs:{clickOutside:"clickOutside"}})}}return i})(),_o=(()=>{class i{constructor(){this._el=l(q),this.manualDisabled=p(null,{alias:"manualDisabled"}),this._syncDisabledEffect=A(()=>{let e=this.manualDisabled();if(e==null)return;let n=this._el.nativeElement;n&&(n.disabled=!!e)})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275dir=F({type:i,selectors:[["input","manualDisabled",""],["textarea","manualDisabled",""]],inputs:{manualDisabled:[1,"manualDisabled"]}})}}return i})();var yo=(()=>{class i{constructor(){this._el=l(q),this.manualType=p(null,{alias:"manualType"}),this._syncTypeEffect=A(()=>{let e=this.manualType();if(!e)return;let n=this._el.nativeElement;n&&n.type!==e&&(n.type=e)})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275dir=F({type:i,selectors:[["input","manualType",""],["textarea","manualType",""]],inputs:{manualType:[1,"manualType"]}})}}return i})();var yi=(()=>{class i{constructor(){this._signals=new Map,this._closers=new Map,this._streams=new Map,this._done=new Map}_getSignal(e){let n=this._signals.get(e);return n||(n=f(void 0,{equal:()=>!1}),this._signals.set(e,n)),n}_getCloser(e){let n=this._closers.get(e);return n||(n=new We,this._closers.set(e,n)),n}_getStream(e){let n=this._streams.get(e);if(!n){let r=this._getSignal(e),s=this._getCloser(e);n=At(r).pipe(yn(1),Se(s),_n()),this._streams.set(e,n)}return n}emit(e,n){this._getSignal(e).set(n)}on(e){return this._getStream(e)}off(e){let n=this._closers.get(e);n&&(n.next(),n.complete(),this._closers.delete(e)),this._signals.delete(e),this._streams.delete(e)}offAll(){for(let e of Array.from(this._closers.keys()))this.off(e)}has(e){return this._signals.has(e)}_getDoneSignal(e){let n=this._done.get(e);return n||(n=f(void 0),this._done.set(e,n)),n}complete(e,n=!0){this._getDoneSignal(e).set(n)}clearCompleted(e){(this._done.get(e)??this._getDoneSignal(e)).set(void 0)}completed(e){return this._getDoneSignal(e)()}isCompleted(e){return this._getDoneSignal(e)()!==void 0}onComplete(e,n){let r=(Array.isArray(e)?e:[e]).filter(Boolean),s=r.map(a=>At(this._getDoneSignal(a)).pipe(Ke(c=>c!==void 0),ze(c=>c))),o;if(r.length<=1?o=s[0]?.pipe(Me(1))??new V:n?.mode==="any"?o=mn(...s).pipe(Me(1)):o=hn(s).pipe(Me(1)),n?.timeoutMs&&Number.isFinite(n.timeoutMs)&&(o=o.pipe(un({first:n.timeoutMs}))),n?.abort){let a=new V(c=>{let u=()=>{c.next(),c.complete()};return n.abort.addEventListener("abort",u),()=>n.abort.removeEventListener("abort",u)});o=o.pipe(Se(a))}return o}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Pt=(()=>{class i{constructor(e,n){if(this._http=n,this._isBrowser=G(l(B)),this.errors=[],this.url="",this.locked=!1,this.awaitLocked=[],this._headers={},this._http_headers=new fe(this._headers),this._config=d(d({},Vr),e.http||{}),typeof this._config.url=="string"&&this.setUrl(this._config.url),this._isBrowser){this.url=localStorage.getItem("wacom-http.url")||this.url;let r=localStorage.getItem("wacom-http.headers");this._headers=r?JSON.parse(r):this._headers,this._http_headers=new fe(this._headers)}if(typeof this._config.headers=="object"){for(let r in this._config.headers)this._headers[r]=this._config.headers[r];this._http_headers=new fe(this._headers)}}setUrl(e){this.url=e,this._isBrowser&&localStorage.setItem("wacom-http.url",e)}removeUrl(){this.url=this._config.url||"",this._isBrowser&&localStorage.removeItem("wacom-http.url")}set(e,n){this._headers[e]=n,this._isBrowser&&localStorage.setItem("wacom-http.headers",JSON.stringify(this._headers)),this._http_headers=new fe(this._headers)}header(e){return this._headers[e]}remove(e){delete this._headers[e],this._isBrowser&&localStorage.setItem("wacom-http.headers",JSON.stringify(this._headers)),this._http_headers=new fe(this._headers)}_httpMethod(e,n,r,s){return e==="post"?this._http.post(n,r,s):e==="put"?this._http.put(n,r,s):e==="patch"?this._http.patch(n,r,s):e==="delete"?this._http.delete(n,s):this._http.get(n,s)}_post(e,n,r=a=>{},s={},o="post"){if(typeof s=="function"&&(s={err:s}),s.err||(s.err=u=>{}),this.locked&&!s.skipLock)return new V(u=>{let _=setTimeout(()=>{this._post(e,n,r,s,o).subscribe(u)},100);this.awaitLocked.push(_)});let a=(s.url||this.url)+e;this.prepare_handle(a,n);let c=new qe(1);return this._httpMethod(o,a,n,{headers:this._http_headers}).pipe(gn(),pn(u=>(this.handleError(s.err,()=>{this._post(e,n,r,s,o).subscribe(c)})(u),c.error(u),dn))).subscribe({next:u=>{if(s.acceptance&&typeof s.acceptance=="function"&&!s.acceptance(u)){let _=new Un({error:"Acceptance failed",status:400});this.handleError(s.err,()=>{})(_),c.error(_);return}if(s.replace&&typeof s.replace=="function"&&(Array.isArray(this._getObjectToReplace(u,s.data))?this._getObjectToReplace(u,s.data).map(_=>s.replace(_)):this._getObjectToReplace(u,s.data)&&s.replace(this._getObjectToReplace(u,s.data))),Array.isArray(s.fields)){if(Array.isArray(this._getObjectToReplace(u,s.data)))this._getObjectToReplace(u,s.data).map(_=>this._newDoc(_,s.fields));else if(this._getObjectToReplace(u,s.data)){let _=this._newDoc(this._getObjectToReplace(u,s.data),s.fields);s.data?this._setObjectToReplace(u,s.data,_):u=_}}this.response_handle(a,u,()=>r(u)),c.next(u),c.complete()},error:u=>c.error(u),complete:()=>c.complete()}),c.asObservable()}post(e,n,r=o=>{},s={}){return this._post(e,n,r,s)}put(e,n,r=o=>{},s={}){return this._post(e,n,r,s,"put")}patch(e,n,r=o=>{},s={}){return this._post(e,n,r,s,"patch")}delete(e,n=s=>{},r={}){return this._post(e,null,n,r,"delete")}get(e,n=s=>{},r={}){return this._post(e,null,n,r,"get")}clearLocked(){for(let e of this.awaitLocked)clearTimeout(e);this.awaitLocked=[]}lock(){this.locked=!0}unlock(){this.locked=!1}handleError(e,n){return r=>new Promise(s=>{this.err_handle(r,e,n),s()})}err_handle(e,n,r){typeof n=="function"&&n(e);for(let s of this.errors)typeof s=="function"&&s(e,r)}prepare_handle(e,n){}response_handle(e,n,r){typeof r=="function"&&r()}_getObjectToReplace(e,n=""){if(n.includes(".")){let r=n.split(""),s=r.pop()||"";return this._getObjectToReplace(e[s]||{},r.join("."))}else return n?e[n]:e}_setObjectToReplace(e,n="",r){for(;n.includes(".");){let s=n.split(""),o=s.pop()||"";e=e[o]||{},n=s.join(".")}e[n]=r}_newDoc(e,n){let r={};for(let s of n)r[s]=e[s];return r}static{this.\u0275fac=function(n){return new(n||i)(O(Re,8),O($n))}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),kr=(()=>{class i{constructor(e){this._isBrowser=G(l(B)),this._status=f(this._isBrowser&&navigator.onLine?"poor":"none"),this._latencyMs=f(null),this._isOnline=f(this._isBrowser?navigator.onLine:!1),this.status=this._status.asReadonly(),this.latencyMs=this._latencyMs.asReadonly(),this.isOnline=this._isOnline.asReadonly(),this._fails=0,this._emitterService=l(yi),this._config=d(d({},Ar),e.network||{}),this._isBrowser&&(this._bindEvents(),this.recheckNow(),window.setInterval(()=>this.recheckNow(),this._config.intervalMs))}recheckNow(){return y(this,null,function*(){if(!this._isBrowser)return;let e=yield this._pingAny();e.ok&&e.latency!=null?(this._fails=0,this._latencyMs.set(e.latency),this._isOnline.set(!0)):(this._fails++,this._latencyMs.set(null)),this._updateClassification()})}_updateClassification(){if(!this._isOnline()||this._fails>=this._config.maxConsecutiveFails){this._status()!=="none"&&(this._status.set("none"),this._emitterService.emit("wacom_offline"));return}let e=this._latencyMs();e!=null&&e<=this._config.goodLatencyMs?this._status()!=="good"&&(this._status.set("good"),this._emitterService.emit("wacom_online")):this._status()!=="poor"&&(this._status.set("poor"),this._emitterService.emit("wacom_online"))}_bindEvents(){this._isBrowser&&(window.addEventListener("online",()=>{this._isOnline.set(!0),this.recheckNow()}),window.addEventListener("offline",()=>{this._isOnline.set(!1),this._updateClassification()}),navigator.connection?.addEventListener?.("change",()=>this.recheckNow()))}_pingAny(){return y(this,null,function*(){if(!this._isBrowser)return{ok:!1,latency:null};for(let e of this._config.endpoints){let n=!e.includes("api.webart.work"),r=yield this._measure(e,this._config.timeoutMs,n).catch(()=>null);if(r?.ok)return r}return{ok:!1,latency:null}})}_measure(e,n,r=!1){return y(this,null,function*(){let s=new AbortController,o=setTimeout(()=>s.abort(),n),a=performance.now();try{let c=yield fetch(e+(e.includes("?")?"&":"?")+"t="+Date.now(),{method:"GET",cache:"no-store",credentials:"omit",signal:s.signal,mode:r?"no-cors":"cors"});clearTimeout(o);let u=Math.round(performance.now()-a);return{ok:r?!0:c.ok,latency:u}}catch{return clearTimeout(o),{ok:!1,latency:null}}})}static{this.\u0275fac=function(n){return new(n||i)(O(Re,8))}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Rt=(()=>{class i{constructor(e){this._isBrowser=G(l(B)),this._prefix="",this._config=d(d({},Tt),e?.store||{})}setPrefix(e){this._prefix=e}set(e,n,r=()=>{},s=()=>{}){return y(this,null,function*(){e=this._applyPrefix(e);try{if(this._config.set)yield this._config.set(e,n,r,s);else{if(!this._isBrowser)return r(),!0;localStorage.setItem(e,n),r()}return!0}catch(o){return console.error(o),s(o),!1}})}get(e,n,r=()=>{}){return y(this,null,function*(){e=this._applyPrefix(e);try{if(this._config.get)return(yield this._config.get(e,o=>{n?.(o??null)},r))??null;{if(!this._isBrowser)return n?.(null),null;let s=localStorage.getItem(e);return n?.(s??null),s??null}}catch(s){return console.error(s),r(s),null}})}setJson(e,n,r=()=>{},s=()=>{}){return y(this,null,function*(){return yield this.set(e,JSON.stringify(n),r,s)})}getJson(e,n,r=()=>{}){return y(this,null,function*(){let s=yield this.get(e);if(s===null)return null;try{let o=JSON.parse(s);return n?.(o),o}catch(o){return r?.(o),console.error(o),null}})}remove(e,n=()=>{},r=()=>{}){return y(this,null,function*(){e=this._applyPrefix(e);try{return this._config.remove?yield this._config.remove(e,n,r):this._isBrowser?(localStorage.removeItem(e),n(),!0):(n(),!0)}catch(s){return console.error(s),r(s),!1}})}clear(e,n){return y(this,null,function*(){try{if(this._config.clear)yield this._config.clear();else{if(!this._isBrowser)return e?.(),!0;localStorage.clear()}return e?.(),!0}catch(r){return console.error(r),n?.(r),!1}})}_applyPrefix(e){return this._config.prefix&&(e=this._config.prefix+e),this._prefix&&(e=this._prefix+e),e}static{this.\u0275fac=function(n){return new(n||i)(O(Re,8))}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),ge=class{constructor(t){this._config=t,this._isBrowser=G(l(B)),this._url="/api/",this._docs=[],this._perPage=20,this._filteredDocumentsCallbacks=[],this.__httpService=l(Pt),this.__storeService=l(Rt),this.__coreService=l(_e),this.__emitterService=l(yi),this.__networkService=l(kr),this._signal={},this._signals={},this._fieldSignals={},this._fetchingId={},this._onOnline=[],this._randomCount=0,this._config.signalFields=this._config.signalFields||{},this._url+=this._config.name,this.loaded=this.__emitterService.onComplete(this._config.name+"_loaded"),this.getted=this.__emitterService.onComplete(this._config.name+"_getted"),this._config.unauthorized?this.restoreDocs():this._isBrowser&&localStorage.getItem("waw_user")&&JSON.parse(localStorage.getItem("waw_user"))._id===localStorage.getItem(this._config.name+"waw_user_id")&&this.restoreDocs(),this.__emitterService.on("wipe").subscribe(()=>{this.clearDocs(),this._filterDocuments()}),this.__emitterService.on("wacom_online").subscribe(()=>{for(let e of this._onOnline)e();this._onOnline.length=0})}getSignal(t){if(typeof t!="string"&&(t=this._id(t)),this._signal[t])return this._signal[t];let e=this.doc(t);return this._signal[t]=this.__coreService.toSignal(e,this._config.signalFields),this._signal[t]}getSignals(t,e){let n=t+"_"+JSON.stringify(e);return this._signals[n]||(this._signals[n]=f(this._getSignals(n))),this._signals[n]}_getSignals(t){let e=t.indexOf("_");if(e===-1)return[];let n=t.slice(0,e),r=t.slice(e+1),s=[];for(let o of this.getDocs()){if(JSON.stringify(o[n])!==r)continue;let a=this._id(o);a&&s.push(this.getSignal(a))}return s}getFieldSignals(t){return this._fieldSignals[t]||(this._fieldSignals[t]=f(this._getFieldSignals(t))),this._fieldSignals[t]}_getFieldSignals(t){let e={};for(let n of this.getDocs()){let r=this._id(n);if(!r)continue;let s=String(n[t]);e[s]||(e[s]=[]),e[s].push(this.getSignal(r))}return e}removeSignals(t=[]){for(let e in this._signal)t.includes(e)||delete this._signal[e]}restoreDocs(){return y(this,null,function*(){let t=yield this.__storeService.getJson("docs_"+this._config.name);if(t?.length){this._docs.length=0,this._docs.push(...t),this._filterDocuments();for(let e of this._docs)if(e.__deleted)this.delete(e,e.__options?.delete||{});else if(!e._id)this.create(e,e.__options?.create||{});else if(e.__modified?.length)for(let n of e.__modified)n.startsWith("up")?this.update(e,e.__options?.[n]||{}):this.unique(e,e.__options?.[n]||{});this.__emitterService.complete(this._config.name+"_loaded",this._docs)}})}setDocs(){this.__storeService.setJson("docs_"+this._config.name,this._docs)}getDocs(t=()=>!0){return this._docs.filter(t)}getDoc(t){return this._docs.find(t)}clearDocs(){this._docs.splice(0,this._docs.length),this.setDocs(),this._updateSignals()}addDocs(t){if(Array.isArray(t))for(let e of t)this.addDoc(e)}addDoc(t){this._config.replace&&this._config.replace(t);let e=this._docs.find(n=>this._id(t)&&this._id(n)===this._id(t)||t._localId&&n._localId===t._localId);e?(this.__coreService.copy(t,e),this.__coreService.copy(e,t),this._syncSignalForDoc(e)):(this._docs.push(t),this._syncSignalForDoc(t)),this.setDocs()}new(t={}){return g(d({},t),{_id:void 0,_localId:this._localId(),__created:!1,__modified:!1})}doc(t){if(this._signal[t])return this._signal[t]();let e=this._docs.find(n=>this._id(n)===t||n._localId&&n._localId===Number(t))||null;return e||(e=this.new({_id:t}),this._docs.push(e),this.setDocs()),!this._docs.find(n=>this._id(n)===t)&&!this._fetchingId[t]&&(this._fetchingId[t]=!0,setTimeout(()=>{this.fetch({_id:t}).subscribe(n=>{this._fetchingId[t]=!1,n&&(this.__coreService.copy(n,e),this._syncSignalForDoc(e))})})),e}setPerPage(t){this._perPage=t}beforeCreate(t,e){return t}afterCreate(t,e,n){}beforeUpdate(t,e){return t}afterUpdate(t,e,n){}beforeUnique(t,e){return t}afterUnique(t,e,n){}beforeDelete(t,e){return t}afterDelete(t,e,n){}beforeFetch(t,e){return t}afterFetch(t,e,n){}_mw(t){return Promise.resolve(t)}get(t={},e={}){if(!this.__networkService.isOnline())return new V(o=>{this._onOnline.push(()=>{this.get(t,e).subscribe(o)})});if(this._isBrowser&&!this._config.unauthorized&&localStorage.getItem("waw_user")){let o=JSON.parse(localStorage.getItem("waw_user"));localStorage.setItem(this._config.name+"waw_user_id",o._id)}let n=`${this._url}/get${e.name||""}`,r=(typeof t.page=="number"||t.query?"?":"")+(t.query||"")+(typeof t.page=="number"?`&skip=${this._perPage*(t.page-1)}&limit=${this._perPage}`:""),s=this.__httpService.get(`${n}${r}`);return s.subscribe({next:o=>{o=o||[],typeof t.page!="number"&&this.clearDocs(),o.forEach(a=>this.addDoc(a)),e.callback&&e.callback(o),typeof t.page!="number"&&(this._filterDocuments(),this.__emitterService.complete(this._config.name+"_getted",this._docs)),this.__emitterService.emit(`${this._config.name}_get`,this._docs),this.__emitterService.emit(`${this._config.name}_changed`,this._docs)},error:o=>{e.errCallback&&e.errCallback(o)}}),s}create(t={},e={}){return se(()=>K(this._mw(this.beforeCreate(t,e))).pipe(oe(n=>{if(t=n||t,t._id)return this.update(t,e);if(t._localId||=this._localId(),t.__options||={},t.__options.create=e,this.addDoc(t),this._filterDocuments(),!this.__networkService.isOnline())return new V(s=>{this._onOnline.push(()=>{this.create(t,e).subscribe(s)})});if(t.__creating)return new V(s=>{s.error(new Error("Document is currently already creating."))});this._config.appId&&(t.appId=this._config.appId),t.__creating=!0;let r=this.__httpService.post(`${this._url}/create${e.name||""}`,t);return r.subscribe({next:s=>y(this,null,function*(){s?(this.__coreService.copy(s,t),this.addDoc(t),this._filterDocuments(),e.callback&&e.callback(t),yield this._mw(this.afterCreate(s,t,e))):(t.__creating=!1,e.errCallback&&e.errCallback(s)),this.__emitterService.emit(`${this._config.name}_create`,t),this.__emitterService.emit(`${this._config.name}_list`,t),this.__emitterService.emit(`${this._config.name}_changed`,t)}),error:s=>{t.__creating=!1,e.errCallback&&e.errCallback(s)}}),r})))}fetch(t={},e={}){return se(()=>K(this._mw(this.beforeFetch(t,e))).pipe(oe(n=>{if(t=n||t,!this.__networkService.isOnline())return new V(s=>{this._onOnline.push(()=>{this.fetch(t,e).subscribe(s)})});let r=this.__httpService.post(`${this._url}/fetch${e.name||""}`,t);return r.subscribe({next:s=>y(this,null,function*(){s?(this.addDoc(s),this._filterDocuments(),e.callback&&e.callback(s),yield this._mw(this.afterFetch(s,t,e)),this.__emitterService.emit(`${this._config.name}_changed`,s)):e.errCallback&&e.errCallback(s)}),error:s=>{e.errCallback&&e.errCallback(s)}}),r})))}updateAfterWhile(t,e={}){return new V(n=>{this.__coreService.afterWhile(this._id(t),()=>{this.update(t,e).subscribe({next:r=>{n.next(r)},error:r=>{n.error(r)},complete:()=>{n.complete()}})})})}update(t,e={}){return se(()=>K(this._mw(this.beforeUpdate(t,e))).pipe(oe(n=>{if(t=n||t,this._updateModified(t,"up"+(e.name||""),e),!this.__networkService.isOnline())return new V(s=>{this._onOnline.push(()=>{this.update(t,e).subscribe(s)})});let r=this.__httpService.post(`${this._url}/update${e.name||""}`,t);return r.subscribe({next:s=>y(this,null,function*(){if(s){this._removeModified(t,"up"+(e.name||""));let o=this.doc(t._id);this.__coreService.copy(s,o),this.__coreService.copy(s,t),this._syncSignalForDoc(o),e.callback&&e.callback(t),yield this._mw(this.afterUpdate(s,t,e))}else e.errCallback&&e.errCallback(s);this.__emitterService.emit(`${this._config.name}_update`,t),this.__emitterService.emit(`${this._config.name}_changed`,t)}),error:s=>{e.errCallback&&e.errCallback(s)}}),r})))}unique(t,e={}){return se(()=>K(this._mw(this.beforeUnique(t,e))).pipe(oe(n=>{if(t=n||t,this._updateModified(t,"un"+(e.name||""),e),!this.__networkService.isOnline())return new V(s=>{this._onOnline.push(()=>{this.unique(t,e).subscribe(s)})});let r=this.__httpService.post(`${this._url}/unique${e.name||""}`,t);return r.subscribe({next:s=>y(this,null,function*(){s?(this._removeModified(t,"un"+(e.name||"")),t[e.name]=s,this._syncSignalForDoc(t),e.callback&&e.callback(t),yield this._mw(this.afterUnique(s,t,e))):e.errCallback&&e.errCallback(s),this.__emitterService.emit(`${this._config.name}_unique`,t),this.__emitterService.emit(`${this._config.name}_changed`,t)}),error:s=>{e.errCallback&&e.errCallback(s)}}),r})))}delete(t,e={}){return se(()=>K(this._mw(this.beforeDelete(t,e))).pipe(oe(n=>{if(t=n||t,t.__deleted=!0,t.__options||={},t.__options.delete=e,this.addDoc(t),this._filterDocuments(),!this.__networkService.isOnline())return new V(s=>{this._onOnline.push(()=>{this.delete(t,e).subscribe(s)})});let r=this.__httpService.post(`${this._url}/delete${e.name||""}`,t);return r.subscribe({next:s=>y(this,null,function*(){if(s){let o=this._docs.findIndex(a=>this._id(a)===this._id(t));o!==-1&&this._docs.splice(o,1),this.setDocs(),this._syncSignalForDoc(g(d({},t),{__deleted:!0})),this._filterDocuments(),e.callback&&e.callback(t),yield this._mw(this.afterDelete(s,t,e))}else e.errCallback&&e.errCallback(s);this.__emitterService.emit(`${this._config.name}_delete`,t),this.__emitterService.emit(`${this._config.name}_changed`,t)}),error:s=>{e.errCallback&&e.errCallback(s)}}),r})))}filteredDocuments(t,e={}){let n=()=>{if(Array.isArray(t)){let r=this._docs.filter(s=>!s.__deleted).filter(e.valid??(()=>!0));t.length=0,typeof e.sort=="function"&&(r=r.sort(e.sort)),t.push(...r)}else{let r=t;for(let s in r)for(let o=r[s].length-1;o>=0;o--){let a=typeof e.field=="function"?e.field(r[s][o]):e.field||"author",c=r[s][o];this._docs.find(u=>Array.isArray(u[a])?u[a].includes(c[this._id(u)]):u[a]===c[this._id(u)])||r[s].splice(o,1)}for(let s of this._docs){if(s.__deleted)continue;let o=typeof e.field=="function"?e.field(s):e.field||"author";(typeof e.valid=="function"?!e.valid(s):Array.isArray(s[o])?!s[o]?.length:!s[o])||(typeof e.field=="function"?e.field(s)&&!r[s[o]].find(a=>a._id===s._id)&&r[s[o]].push(s):Array.isArray(s[o])?s[o].forEach(a=>{r[a]=r[a]||[],r[a].find(c=>c._id===s._id)||r[a].push(s)}):(r[s[o]]=r[s[o]]||[],r[s[o]].find(a=>a._id===s._id)||r[s[o]].push(s)))}if(typeof e.sort=="function")for(let s in r)r[s].sort(e.sort)}e.filtered?.(t)};return this._filteredDocumentsCallbacks.push(n),n}_localId(){return+(Date.now()+""+this._randomCount++)}_id(t){return t[this._config._id||"_id"]?.toString()}_filterDocuments(){for(let t of this._filteredDocumentsCallbacks)t();this.__emitterService.emit(`${this._config.name}_filtered`)}_updateModified(t,e,n){t.__modified||=[],t.__options||={},t.__options[e]=n,t.__modified.find(r=>r===e)||(t.__modified.push(e),this.addDoc(t))}_removeModified(t,e){t.__modified||=[],t.__modified.find(n=>n===e)&&(t.__modified.splice(t.__modified.findIndex(n=>n===e),1),this.addDoc(t))}_syncSignalForDoc(t){let e=this._id(t);e&&this._signal[e]&&this._signal[e].set(d({},t)),this._updateSignals()}_updateSignals(){for(let t in this._signals)this._signals[t].set(this._getSignals(t));for(let t in this._fieldSignals)this._fieldSignals[t].set(this._getFieldSignals(t))}},vi=(()=>{class i{constructor(){this._isBrowser=G(l(B)),this._appRef=l(Dt),this._injector=l(bn),this._doc=l(Ae),this._providedIn={}}appendById(e,n={},r){let s=et(e,{environmentInjector:this._injector});this.projectComponentInputs(s,n),this._appRef.attachView(s.hostView);let o=s.hostView.rootNodes[0],a=this._doc.getElementById(r);return this._isBrowser&&a&&typeof a.appendChild=="function"&&a.appendChild(o),s.changeDetectorRef.detectChanges(),{nativeElement:o,componentRef:s,remove:()=>this.removeComponent(s)}}appendComponent(e,n={},r){if(n.providedIn){if(this._providedIn[n.providedIn])return;this._providedIn[n.providedIn]=!0}let s=et(e,{environmentInjector:this._injector});this.projectComponentInputs(s,n),this._appRef.attachView(s.hostView);let o=s.hostView.rootNodes[0],a=r||this._doc.body;return this._isBrowser&&a&&typeof a.appendChild=="function"&&a.appendChild(o),s.changeDetectorRef.detectChanges(),{nativeElement:o,componentRef:s,remove:()=>this.removeComponent(s,n.providedIn)}}getComponentRef(e,n={}){let r=et(e,{environmentInjector:this._injector});return this.projectComponentInputs(r,n),this._appRef.attachView(r.hostView),r.changeDetectorRef.detectChanges(),r}projectComponentInputs(e,n){if(n){let r=Object.getOwnPropertyNames(n);for(let s of r)e.instance[s]=n[s]}return e}removeComponent(e,n){this._appRef.detachView(e.hostView),e.destroy(),n&&delete this._providedIn[n]}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var vo=(()=>{class i{constructor(){this._doc=l(Ae),this._isBrowser=G(l(B)),this.mode=f(void 0),this.modes=f(["light","dark"]),this.density=f(void 0),this.densities=f(["comfortable","compact"]),this.radius=f(void 0),this.radiuses=f(["rounded","square"]),this.themeIndex=f(0)}setMode(e){this._isBrowser&&(this._doc.documentElement.dataset.mode=e,localStorage.setItem("theme.mode",e)),this.mode.set(e)}setDensity(e){this._isBrowser&&(this._doc.documentElement.dataset.density=e,localStorage.setItem("theme.density",e)),this.density.set(e)}setRadius(e){this._isBrowser&&(this._doc.documentElement.dataset.radius=e,localStorage.setItem("theme.radius",e)),this.radius.set(e)}nextTheme(){let e=this.modes().length,n=this.densities().length,r=this.radiuses().length,s=e*n*r,o=(this.themeIndex()+1)%s;this.themeIndex.set(o);let a=n*r,c=Math.floor(o/a),u=o%a,_=Math.floor(u/r),yt=u%r;this.setMode(this.modes()[c]),this.setDensity(this.densities()[_]),this.setRadius(this.radiuses()[yt]),this._isBrowser&&localStorage.setItem("theme.index",String(o))}init(){let e=this._isBrowser&&localStorage.getItem("theme.mode")||"light",n=this._isBrowser&&localStorage.getItem("theme.density")||"comfortable",r=this._isBrowser&&localStorage.getItem("theme.radius")||"rounded";this.mode.set(e),this.density.set(n),this.radius.set(r),this.themeIndex.set(this._isBrowser&&Number(localStorage.getItem("theme.index"))||0),this._isBrowser&&(this._doc.documentElement.dataset.mode=e,this._doc.documentElement.dataset.density=n,this._doc.documentElement.dataset.radius=r)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function bo(i=Tt){return vn([{provide:Re,useValue:i},Gn(Hn())])}var jt=0;function Ir(){return jt}function Y(i,t){return(...e)=>{try{return jt=t,i(...e)}finally{jt=0}}}function Fr(i){return!i}function bi(i){return i}function H(i){return Array.isArray(i)}function ye(i){return(typeof i=="object"||typeof i=="function")&&i!=null}var ie=Symbol(),mt=Symbol(),Be=class{predicates;fns=[];constructor(t){this.predicates=t}push(t){this.fns.push(wi(this.predicates,t))}mergeIn(t){let e=this.predicates?t.fns.map(n=>wi(this.predicates,n)):t.fns;this.fns.push(...e)}},ct=class extends Be{get defaultValue(){return!1}compute(t){return this.fns.some(e=>{let n=e(t);return n&&n!==mt})}},ve=class i extends Be{ignore;static ignoreNull(t){return new i(t,e=>e===null)}constructor(t,e){super(t),this.ignore=e}get defaultValue(){return[]}compute(t){return this.fns.reduce((e,n)=>{let r=n(t);return r===void 0||r===mt?e:H(r)?[...e,...this.ignore?r.filter(s=>!this.ignore(s)):r]:this.ignore&&this.ignore(r)?e:[...e,r]},[])}},Bt=class extends ve{constructor(t){super(t,void 0)}},Lt=class extends Be{key;get defaultValue(){return this.key.reducer.getInitial()}constructor(t,e){super(t),this.key=e}compute(t){if(this.fns.length===0)return this.key.reducer.getInitial();let e=this.key.reducer.getInitial();for(let n=0;n<this.fns.length;n++){let r=this.fns[n](t);r!==mt&&(e=this.key.reducer.reduce(e,r))}return e}};function wi(i,t){return i.length===0?t:e=>{for(let n of i){let r=e.stateOf(n.path),s=m(r.structure.pathKeys).length-n.depth;for(let o=0;o<s;o++)r=r.structure.parent;if(!n.fn(r.context))return mt}return t(e)}}var be=class{predicates;hidden;disabledReasons;readonly;syncErrors;syncTreeErrors;asyncErrors;metadata=new Map;constructor(t){this.predicates=t,this.hidden=new ct(t),this.disabledReasons=new Bt(t),this.readonly=new ct(t),this.syncErrors=ve.ignoreNull(t),this.syncTreeErrors=ve.ignoreNull(t),this.asyncErrors=ve.ignoreNull(t)}hasMetadata(t){return this.metadata.has(t)}getMetadataKeys(){return this.metadata.keys()}getMetadata(t){return this.metadata.has(t)||this.metadata.set(t,new Lt(this.predicates,t)),this.metadata.get(t)}mergeIn(t){this.hidden.mergeIn(t.hidden),this.disabledReasons.mergeIn(t.disabledReasons),this.readonly.mergeIn(t.readonly),this.syncErrors.mergeIn(t.syncErrors),this.syncTreeErrors.mergeIn(t.syncTreeErrors),this.asyncErrors.mergeIn(t.asyncErrors);for(let e of t.getMetadataKeys()){let n=t.metadata.get(e);this.getMetadata(e).mergeIn(n)}}},dt=class{depth;constructor(t){this.depth=t}build(){return new ut(this,[],0)}},we=class i extends dt{constructor(t){super(t)}current;all=[];addHiddenRule(t){this.getCurrent().addHiddenRule(t)}addDisabledReasonRule(t){this.getCurrent().addDisabledReasonRule(t)}addReadonlyRule(t){this.getCurrent().addReadonlyRule(t)}addSyncErrorRule(t){this.getCurrent().addSyncErrorRule(t)}addSyncTreeErrorRule(t){this.getCurrent().addSyncTreeErrorRule(t)}addAsyncErrorRule(t){this.getCurrent().addAsyncErrorRule(t)}addMetadataRule(t,e){this.getCurrent().addMetadataRule(t,e)}getChild(t){if(t===ie){let e=this.getCurrent().children;e.size>(e.has(ie)?1:0)&&(this.current=void 0)}return this.getCurrent().getChild(t)}hasLogic(t){return this===t?!0:this.all.some(({builder:e})=>e.hasLogic(t))}mergeIn(t,e){e?this.all.push({builder:t,predicate:{fn:Y(e.fn,this.depth),path:e.path}}):this.all.push({builder:t}),this.current=void 0}getCurrent(){return this.current===void 0&&(this.current=new Le(this.depth),this.all.push({builder:this.current})),this.current}static newRoot(){return new i(0)}},Le=class extends dt{logic=new be([]);children=new Map;constructor(t){super(t)}addHiddenRule(t){this.logic.hidden.push(Y(t,this.depth))}addDisabledReasonRule(t){this.logic.disabledReasons.push(Y(t,this.depth))}addReadonlyRule(t){this.logic.readonly.push(Y(t,this.depth))}addSyncErrorRule(t){this.logic.syncErrors.push(Y(t,this.depth))}addSyncTreeErrorRule(t){this.logic.syncTreeErrors.push(Y(t,this.depth))}addAsyncErrorRule(t){this.logic.asyncErrors.push(Y(t,this.depth))}addMetadataRule(t,e){this.logic.getMetadata(t).push(Y(e,this.depth))}getChild(t){return this.children.has(t)||this.children.set(t,new we(this.depth+1)),this.children.get(t)}hasLogic(t){return this===t}},ut=class i{builder;predicates;depth;logic;constructor(t,e,n){this.builder=t,this.predicates=e,this.depth=n,this.logic=t?Nr(t,e,n):new be([])}getChild(t){let e=this.builder?Di(this.builder,t):[];if(e.length===0)return new i(void 0,[],this.depth+1);if(e.length===1){let{builder:n,predicates:r}=e[0];return new i(n,[...this.predicates,...r.map(s=>$t(s,this.depth))],this.depth+1)}else{let n=e.map(({builder:r,predicates:s})=>new i(r,[...this.predicates,...s.map(o=>$t(o,this.depth))],this.depth+1));return new Ut(n)}}hasLogic(t){return this.builder?.hasLogic(t)??!1}},Ut=class i{all;logic;constructor(t){this.all=t,this.logic=new be([]);for(let e of t)this.logic.mergeIn(e.logic)}getChild(t){return new i(this.all.flatMap(e=>e.getChild(t)))}hasLogic(t){return this.all.some(e=>e.hasLogic(t))}};function Di(i,t){if(i instanceof we)return i.all.flatMap(({builder:e,predicate:n})=>{let r=Di(e,t);return n?r.map(({builder:s,predicates:o})=>({builder:s,predicates:[...o,n]})):r});if(i instanceof Le)return[...t!==ie&&i.children.has(ie)?[{builder:i.getChild(ie),predicates:[]}]:[],...i.children.has(t)?[{builder:i.getChild(t),predicates:[]}]:[]];throw new b(1909,!1)}function Nr(i,t,e){let n=new be(t);if(i instanceof we){let r=i.all.map(({builder:s,predicate:o})=>new ut(s,o?[...t,$t(o,e)]:t,e));for(let s of r)n.mergeIn(s.logic)}else if(i instanceof Le)n.mergeIn(i.logic);else throw new b(1909,!1);return n}function $t(i,t){return g(d({},i),{depth:t})}var Mi=Symbol("PATH"),z=class i{keys;parent;keyInParent;root;children=new Map;fieldPathProxy=new Proxy(this,xr);logicBuilder;constructor(t,e,n,r){this.keys=t,this.parent=n,this.keyInParent=r,this.root=e??this,n||(this.logicBuilder=we.newRoot())}get builder(){return this.logicBuilder?this.logicBuilder:this.parent.builder.getChild(this.keyInParent)}getChild(t){return this.children.has(t)||this.children.set(t,new i([...this.keys,t],this.root,this,t)),this.children.get(t)}mergeIn(t,e){let n=t.compile();this.builder.mergeIn(n.builder,e)}static unwrapFieldPath(t){return t[Mi]}static newRoot(){return new i([],void 0,void 0,void 0)}},xr={get(i,t){return t===Mi?i:i.getChild(t).fieldPathProxy}},lt,je=new Map,Ue=class i{schemaFn;constructor(t){this.schemaFn=t}compile(){if(je.has(this))return je.get(this);let t=z.newRoot();je.set(this,t);let e=lt;try{lt=t,this.schemaFn(t.fieldPathProxy)}finally{lt=e}return t}static create(t){return t instanceof i?t:new i(t)}static rootCompile(t){try{return je.clear(),t===void 0?z.newRoot():t instanceof i?t.compile():new i(t).compile()}finally{je.clear()}}};function Or(i){return i instanceof Ue||typeof i=="function"}function Qt(i){if(lt!==z.unwrapFieldPath(i).root)throw new b(1908,!1)}function Ge(i,t,e){return Qt(i),z.unwrapFieldPath(i).builder.addMetadataRule(t,e),t}var J={list(){return{reduce:(i,t)=>t===void 0?i:[...i,t],getInitial:()=>[]}},min(){return{reduce:(i,t)=>i===void 0||t===void 0?i??t:Math.min(i,t),getInitial:()=>{}}},max(){return{reduce:(i,t)=>i===void 0||t===void 0?i??t:Math.max(i,t),getInitial:()=>{}}},or(){return{reduce:(i,t)=>i||t,getInitial:()=>!1}},and(){return{reduce:(i,t)=>i&&t,getInitial:()=>!0}},override:Tr};function Tr(i){return{reduce:(t,e)=>e,getInitial:()=>i?.()}}var ht=class{reducer;create;brand;constructor(t,e){this.reducer=t,this.create=e}};function W(i){return new ht(i??J.override())}var en=W(J.or()),Si=W(J.max()),Vi=W(J.min()),Ai=W(J.max()),Ei=W(J.min()),tn=W(J.list());function Pr(i){return i.errors().length>0?"invalid":i.pending()?"unknown":"valid"}var Gt=class{node;constructor(t){this.node=t}rawSyncTreeErrors=h(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncTreeErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawSyncTreeErrors()??[]]);syncErrors=h(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.syncErrors.compute(this.node.context),...this.syncTreeErrors(),...Rr(this.node.submitState.submissionErrors())]);syncValid=h(()=>this.shouldSkipValidation()?!0:this.node.structure.reduceChildren(this.syncErrors().length===0,(t,e)=>e&&t.validationState.syncValid(),Fr));syncTreeErrors=h(()=>this.rawSyncTreeErrors().filter(t=>t.fieldTree===this.node.fieldProxy));rawAsyncErrors=h(()=>this.shouldSkipValidation()?[]:[...this.node.logicNode.logic.asyncErrors.compute(this.node.context),...this.node.structure.parent?.validationState.rawAsyncErrors()??[]]);asyncErrors=h(()=>this.shouldSkipValidation()?[]:this.rawAsyncErrors().filter(t=>t==="pending"||t.fieldTree===this.node.fieldProxy));errors=h(()=>[...this.syncErrors(),...this.asyncErrors().filter(t=>t!=="pending")]);errorSummary=h(()=>this.node.structure.reduceChildren(this.errors(),(t,e)=>[...e,...t.errorSummary()]));pending=h(()=>this.node.structure.reduceChildren(this.asyncErrors().includes("pending"),(t,e)=>e||t.validationState.asyncErrors().includes("pending")));status=h(()=>{if(this.shouldSkipValidation())return"valid";let t=Pr(this);return this.node.structure.reduceChildren(t,(e,n)=>n==="invalid"||e.validationState.status()==="invalid"?"invalid":n==="unknown"||e.validationState.status()==="unknown"?"unknown":"valid",e=>e==="invalid")});valid=h(()=>this.status()==="valid");invalid=h(()=>this.status()==="invalid");shouldSkipValidation=h(()=>this.node.hidden()||this.node.disabled()||this.node.readonly())};function Rr(i){return i===void 0?[]:H(i)?i:[i]}function nn(i,t){if(H(i))for(let e of i)e.fieldTree??=t;else i&&(i.fieldTree??=t);return i}var Ht=W(),Wt=class{node;cache=new WeakMap;constructor(t){this.node=t}resolve(t){if(!this.cache.has(t)){let e=h(()=>{let n=z.unwrapFieldPath(t),r=this.node,s=Ir();for(;s>0||!r.structure.logic.hasLogic(n.root.builder);)if(s--,r=r.structure.parent,r===void 0)throw new b(1900,!1);for(let o of n.keys)if(r=r.structure.getChild(o),r===void 0)throw new b(1901,!1);return r.fieldProxy});this.cache.set(t,e)}return this.cache.get(t)()}get fieldTree(){return this.node.fieldProxy}get state(){return this.node}get value(){return this.node.structure.value}get key(){return this.node.structure.keyInParent}get pathKeys(){return this.node.structure.pathKeys}index=h(()=>{let t=this.key();if(!H(m(this.node.structure.parent.value)))throw new b(1906,!1);return Number(t)});fieldTreeOf=t=>this.resolve(t);stateOf=t=>this.resolve(t)();valueOf=t=>{let e=this.resolve(t)().value();if(e instanceof Pe)throw new b(1907,!1);return e}},qt=class{node;metadata=new Map;constructor(t){this.node=t;for(let e of this.node.logicNode.logic.getMetadataKeys())if(e.create){let n=this.node.logicNode.logic.getMetadata(e),r=m(()=>Ve(this.node.structure.injector,()=>e.create(h(()=>n.compute(this.node.context)))));this.metadata.set(e,r)}}get(t){if(this.has(t)&&!this.metadata.has(t)){if(t.create)throw new b(1912,!1);let e=this.node.logicNode.logic.getMetadata(t);this.metadata.set(t,h(()=>e.compute(this.node.context)))}return this.metadata.get(t)}has(t){return this.node.logicNode.logic.hasMetadata(t)}},jr={get(i,t,e){let n=i(),r=n.structure.getChild(t);if(r!==void 0)return r.fieldProxy;let s=m(n.value);if(H(s)){if(t==="length")return n.value().length;if(t===Symbol.iterator)return()=>(n.value(),Array.prototype[Symbol.iterator].apply(n.fieldProxy))}if(ye(s)&&t===Symbol.iterator)return function*(){for(let o in e)yield[o,e[o]]}},getOwnPropertyDescriptor(i,t){let e=m(i().value),n=Reflect.getOwnPropertyDescriptor(e,t);return n&&!n.configurable&&(n.configurable=!0),n},ownKeys(i){let t=m(i().value);return typeof t=="object"&&t!==null?Reflect.ownKeys(t):[]}};function Br(i,t){let e=h(()=>i()[t()]);return e[vt]=i[vt],e.set=n=>{i.update(r=>Lr(r,n,t()))},e.update=n=>{e.set(n(m(e)))},e.asReadonly=()=>e,e}function Lr(i,t,e){if(H(i)){let n=[...i];return n[e]=t,n}else return g(d({},i),{[e]:t})}var ft=class{logic;node;createChildNode;identitySymbol=Symbol();_injector=void 0;get injector(){return this._injector??=j.create({providers:[],parent:this.fieldManager.injector}),this._injector}constructor(t,e,n){this.logic=t,this.node=e,this.createChildNode=n}children(){let t=this.childrenMap();return t===void 0?[]:Array.from(t.byPropertyKey.values()).map(e=>m(e.reader))}getChild(t){let e=t.toString(),n=m(this.childrenMap)?.byPropertyKey.get(e)?.reader;return n||(n=this.createReader(e)),n()}reduceChildren(t,e,n){let r=this.childrenMap();if(!r)return t;let s=t;for(let o of r.byPropertyKey.values()){if(n?.(s))break;s=e(m(o.reader),s)}return s}destroy(){this.injector.destroy()}createKeyInParent(t,e,n){if(t.kind==="root")return ki;if(e===void 0){let r=n;return h(()=>{if(this.parent.structure.getChild(r)!==this.node)throw new b(1902,!1);return r})}else{let r=n;return h(()=>{let s=this.parent.structure.value();if(!H(s))throw new b(1903,!1);let o=s[r];if(ye(o)&&o.hasOwnProperty(this.parent.structure.identitySymbol)&&o[this.parent.structure.identitySymbol]===e)return r;for(let a=0;a<s.length;a++){let c=s[a];if(ye(c)&&c.hasOwnProperty(this.parent.structure.identitySymbol)&&c[this.parent.structure.identitySymbol]===e)return r=a.toString()}throw new b(1904,!1)})}}createChildrenMap(){return Fe({source:this.value,computation:(t,e)=>{if(!ye(t))return;let n=e?.value??{byPropertyKey:new Map},r,s=H(t);n!==void 0&&(s?r=$r(n,t,this.identitySymbol):r=Gr(n,t));for(let o of Object.keys(t)){let a,c=t[o];if(c===void 0){n.byPropertyKey.has(o)&&(r??=d({},n),r.byPropertyKey.delete(o));continue}s&&ye(c)&&!H(c)&&(a=c[this.identitySymbol]??=Symbol(""));let u;a&&(n.byTrackingKey?.has(a)||(r??=d({},n),r.byTrackingKey??=new Map,r.byTrackingKey.set(a,this.createChildNode(o,a,s))),u=(r??n).byTrackingKey.get(a));let _=n.byPropertyKey.get(o);_===void 0?(r??=d({},n),r.byPropertyKey.set(o,{reader:this.createReader(o),node:u??this.createChildNode(o,a,s)})):u&&u!==_.node&&(r??=d({},n),_.node=u)}return r??n}})}createReader(t){return h(()=>this.childrenMap()?.byPropertyKey.get(t)?.node)}},zt=class extends ft{fieldManager;value;get parent(){}get root(){return this.node}get pathKeys(){return Ur}get keyInParent(){return ki}childrenMap;constructor(t,e,n,r,s){super(e,t,s),this.fieldManager=n,this.value=r,this.childrenMap=this.createChildrenMap()}},Kt=class extends ft{logic;parent;root;pathKeys;keyInParent;value;childrenMap;get fieldManager(){return this.root.structure.fieldManager}constructor(t,e,n,r,s,o){super(e,t,o),this.logic=e,this.parent=n,this.root=this.parent.structure.root,this.keyInParent=this.createKeyInParent({kind:"child",parent:n,pathNode:void 0,logic:e,initialKeyInParent:s,identityInParent:r,fieldAdapter:void 0},r,s),this.pathKeys=h(()=>[...n.structure.pathKeys(),this.keyInParent()]),this.value=Br(this.parent.structure.value,this.keyInParent),this.childrenMap=this.createChildrenMap(),this.fieldManager.structures.add(this)}};var Ur=h(()=>[]),ki=h(()=>{throw new b(1905,!1)});function $r(i,t,e){let n,r=new Set(i.byPropertyKey.keys()),s=new Set(i.byTrackingKey?.keys());for(let o=0;o<t.length;o++){let a=t[o];r.delete(o.toString()),ye(a)&&a.hasOwnProperty(e)&&s.delete(a[e])}if(r.size>0){n??=d({},i);for(let o of r)n.byPropertyKey.delete(o)}if(s.size>0){n??=d({},i);for(let o of s)n.byTrackingKey?.delete(o)}return n}function Gr(i,t){let e;for(let n of i.byPropertyKey.keys())t.hasOwnProperty(n)||(e??=d({},i),e.byPropertyKey.delete(n));return e}var Yt=class{node;selfSubmitting=f(!1);submissionErrors;constructor(t){this.node=t,this.submissionErrors=Fe({source:this.node.structure.value,computation:()=>[]})}submitting=h(()=>this.selfSubmitting()||(this.node.structure.parent?.submitting()??!1))},$e=class{structure;validationState;metadataState;nodeState;submitState;fieldAdapter;_context=void 0;get context(){return this._context??=new Wt(this)}fieldProxy=new Proxy(()=>this,jr);pathNode;constructor(t){this.pathNode=t.pathNode,this.fieldAdapter=t.fieldAdapter,this.structure=this.fieldAdapter.createStructure(this,t),this.validationState=this.fieldAdapter.createValidationState(this,t),this.nodeState=this.fieldAdapter.createNodeState(this,t),this.metadataState=new qt(this),this.submitState=new Yt(this)}focusBoundControl(){this.getBindingForFocus()?.focus()}getBindingForFocus(){let t=this.formFieldBindings().filter(e=>e.focus!==void 0).reduce(Ci,void 0);return t||this.structure.children().map(e=>e.getBindingForFocus()).reduce(Ci,void 0)}pendingSync=Fe({source:()=>this.value(),computation:(t,e)=>{e?.value?.abort()}});get logicNode(){return this.structure.logic}get value(){return this.structure.value}_controlValue=Fe(()=>this.value());get controlValue(){return this._controlValue.asReadonly()}get keyInParent(){return this.structure.keyInParent}get errors(){return this.validationState.errors}get errorSummary(){return this.validationState.errorSummary}get pending(){return this.validationState.pending}get valid(){return this.validationState.valid}get invalid(){return this.validationState.invalid}get dirty(){return this.nodeState.dirty}get touched(){return this.nodeState.touched}get disabled(){return this.nodeState.disabled}get disabledReasons(){return this.nodeState.disabledReasons}get hidden(){return this.nodeState.hidden}get readonly(){return this.nodeState.readonly}get formFieldBindings(){return this.nodeState.formFieldBindings}get submitting(){return this.submitState.submitting}get name(){return this.nodeState.name}get max(){return this.metadata(Vi)}get maxLength(){return this.metadata(Ei)}get min(){return this.metadata(Si)}get minLength(){return this.metadata(Ai)}get pattern(){return this.metadata(tn)??Hr}get required(){return this.metadata(en)??Wr}metadata(t){return this.metadataState.get(t)}hasMetadata(t){return this.metadataState.has(t)}markAsTouched(){m(()=>{this.nodeState.markAsTouched(),this.flushSync()})}markAsDirty(){this.nodeState.markAsDirty()}reset(t){m(()=>this._reset(t))}_reset(t){t!==void 0&&this.value.set(t),this.nodeState.markAsUntouched(),this.nodeState.markAsPristine();for(let e of this.structure.children())e._reset()}setControlValue(t){m(()=>{this._controlValue.set(t),this.markAsDirty(),this.debounceSync()})}sync(){this.value.set(this.controlValue())}flushSync(){let t=this.pendingSync();t&&!t.signal.aborted&&(t.abort(),this.sync())}debounceSync(){return y(this,null,function*(){this.pendingSync()?.abort();let t=this.nodeState.debouncer();if(t){let e=new AbortController,n=t(e.signal);if(n&&(this.pendingSync.set(e),yield n,e.signal.aborted))return}this.sync()})}static newRoot(t,e,n,r){return r.newRoot(t,e,n,r)}createStructure(t){return t.kind==="root"?new zt(this,t.logic,t.fieldManager,t.value,this.newChild.bind(this)):new Kt(this,t.logic,t.parent,t.identityInParent,t.initialKeyInParent,this.newChild.bind(this))}newChild(t,e,n){let r,s;return n?(r=this.pathNode.getChild(ie),s=this.structure.logic.getChild(ie)):(r=this.pathNode.getChild(t),s=this.structure.logic.getChild(t)),this.fieldAdapter.newChild({kind:"child",parent:this,pathNode:r,logic:s,initialKeyInParent:t,identityInParent:e,fieldAdapter:this.fieldAdapter})}},Hr=h(()=>[]),Wr=h(()=>!1);function Ci(i,t){return i?t&&i.element.compareDocumentPosition(t.element)&Node.DOCUMENT_POSITION_PRECEDING?t:i:t}var Jt=class{node;selfTouched=f(!1);selfDirty=f(!1);markAsTouched(){this.selfTouched.set(!0)}markAsDirty(){this.selfDirty.set(!0)}markAsPristine(){this.selfDirty.set(!1)}markAsUntouched(){this.selfTouched.set(!1)}formFieldBindings=f([]);constructor(t){this.node=t}dirty=h(()=>{let t=this.selfDirty()&&!this.isNonInteractive();return this.node.structure.reduceChildren(t,(e,n)=>n||e.nodeState.dirty(),bi)});touched=h(()=>{let t=this.selfTouched()&&!this.isNonInteractive();return this.node.structure.reduceChildren(t,(e,n)=>n||e.nodeState.touched(),bi)});disabledReasons=h(()=>[...this.node.structure.parent?.nodeState.disabledReasons()??[],...this.node.logicNode.logic.disabledReasons.compute(this.node.context)]);disabled=h(()=>!!this.disabledReasons().length);readonly=h(()=>(this.node.structure.parent?.nodeState.readonly()||this.node.logicNode.logic.readonly.compute(this.node.context))??!1);hidden=h(()=>(this.node.structure.parent?.nodeState.hidden()||this.node.logicNode.logic.hidden.compute(this.node.context))??!1);name=h(()=>{let t=this.node.structure.parent;return t?`${t.name()}.${this.node.structure.keyInParent()}`:this.node.structure.fieldManager.rootName});debouncer=h(()=>{if(this.node.logicNode.logic.hasMetadata(Ht)){let e=this.node.logicNode.logic.getMetadata(Ht).compute(this.node.context);if(e)return n=>e(this.node.context,n)}return this.node.structure.parent?.nodeState.debouncer?.()});isNonInteractive=h(()=>this.hidden()||this.disabled()||this.readonly())},Zt=class{newRoot(t,e,n,r){return new $e({kind:"root",fieldManager:t,value:e,pathNode:n,logic:n.builder.build(),fieldAdapter:r})}newChild(t){return new $e(t)}createNodeState(t){return new Jt(t)}createValidationState(t){return new Gt(t)}createStructure(t,e){return t.createStructure(e)}},Xt=class{injector;rootName;constructor(t,e){this.injector=t,this.rootName=e??`${this.injector.get(Dn)}.form${qr++}`}structures=new Set;createFieldManagementEffect(t){A(()=>{let e=new Set;this.markStructuresLive(t,e);for(let n of this.structures)e.has(n)||(this.structures.delete(n),m(()=>n.destroy()))},{injector:this.injector})}markStructuresLive(t,e){e.add(t);for(let n of t.children())this.markStructuresLive(n.structure,e)}},qr=0;function zr(i){let t,e,n;return i.length===3?[t,e,n]=i:i.length===2?Or(i[1])?[t,e]=i:[t,n]=i:[t]=i,[t,e,n]}function rn(...i){let[t,e,n]=zr(i),r=n?.injector??l(j),s=Ve(r,()=>Ue.rootCompile(e)),o=new Xt(r,n?.name),a=n?.adapter??new Zt,c=$e.newRoot(o,t,s,a);return o.createFieldManagementEffect(c.structure),c.fieldProxy}function Kr(i,t){return y(this,null,function*(){let e=i();if(!m(()=>(Ii(e),e.invalid()))){e.submitState.selfSubmitting.set(!0);try{let r=yield t(i);r&&Yr(e,r)}finally{e.submitState.selfSubmitting.set(!1)}}})}function Yr(i,t){H(t)||(t=[t]);let e=new Map;for(let n of t){let r=nn(n,i.fieldProxy),s=r.fieldTree(),o=e.get(s);o||(o=[],e.set(s,o)),o.push(r)}for(let[n,r]of e)n.submitState.submissionErrors.set(r)}function Jr(i){return Ue.create(i)}function Ii(i){if(!i.validationState.shouldSkipValidation()){i.markAsTouched();for(let t of i.structure.children())Ii(t)}}var Zr=new x("");var sn=class{field;constructor(t){this.field=t}control=this;get value(){return this.field().value()}get valid(){return this.field().valid()}get invalid(){return this.field().invalid()}get pending(){return this.field().pending()}get disabled(){return this.field().disabled()}get enabled(){return!this.field().disabled()}get errors(){let t=this.field().errors();if(t.length===0)return null;let e={};for(let n of t)e[n.kind]=n;return e}get pristine(){return!this.field().dirty()}get dirty(){return this.field().dirty()}get touched(){return this.field().touched()}get untouched(){return!this.field().touched()}get status(){if(this.field().disabled())return"DISABLED";if(this.field().valid())return"VALID";if(this.field().invalid())return"INVALID";if(this.field().pending())return"PENDING";throw new b(1910,!1)}valueAccessor=null;hasValidator(t){return t===nt.required?this.field().required():!1}updateValueAndValidity(){}},Xr=new x(""),Qr={create:Sn,update:Vn},jo=(()=>{class i{element=l(q).nativeElement;injector=l(j);formField=p.required();state=h(()=>this.formField()());bindingOptions=f(void 0);[Mn]=Qr;config=l(Zr,{optional:!0});classes=Object.entries(this.config?.classes??{}).map(([e,n])=>[e,h(()=>n(this))]);controlValueAccessors=l(ot,{optional:!0,self:!0});interopNgControl;get \u0275interopControl(){return this.controlValueAccessors?.[0]??this.interopNgControl?.valueAccessor??void 0}getOrCreateNgControl(){return this.interopNgControl??=new sn(this.state)}registerAsBinding(e){if(m(this.bindingOptions))throw new b(1913,!1);this.bindingOptions.set(e),A(n=>{let r=this.state();r.nodeState.formFieldBindings.update(s=>[...s,this]),n(()=>{r.nodeState.formFieldBindings.update(s=>s.filter(o=>o!==this))})},{injector:this.injector})}focus(){let e=m(this.bindingOptions);e?.focus?e.focus():this.element.focus()}static \u0275fac=function(n){return new(n||i)};static \u0275dir=F({type:i,selectors:[["","formField",""]],inputs:{formField:[1,"formField"]},features:[Ie([{provide:Xr,useExisting:i},{provide:te,useFactory:()=>l(i).getOrCreateNgControl()}])]})}return i})();function pt(i,t){return i instanceof Function?i(t):i}function Fi(i){return typeof i=="number"?isNaN(i):i===""||i===!1||i==null}function Ni(i,t){Qt(i),z.unwrapFieldPath(i).builder.addSyncErrorRule(n=>nn(t(n),n.fieldTree))}function es(i){return new on(i)}function ts(i,t){return new an(i,t)}var gt=class{__brand=void 0;kind="";fieldTree;message;constructor(t){t&&Object.assign(this,t)}},on=class extends gt{kind="required"};var an=class extends gt{pattern;kind="pattern";constructor(t,e){super(e),this.pattern=t}};function Bo(i,t,e){let n=Ge(i,W(),r=>t instanceof RegExp?t:t(r));Ge(i,tn,({state:r})=>r.metadata(n)()),Ni(i,r=>{if(Fi(r.value()))return;let s=r.state.metadata(n)();if(s!==void 0&&!s.test(r.value()))return e?.error?pt(e.error,r):ts(s,{message:pt(e?.message,r)})})}function xi(i,t){let e=Ge(i,W(),n=>t?.when?t.when(n):!0);Ge(i,en,({state:n})=>n.metadata(e)()),Ni(i,n=>{if(n.state.metadata(e)()&&Fi(n.value()))return t?.error?pt(t.error,n):es({message:pt(t?.message,n)})})}var He={roles:[],production:!0,appId:"appId",url:"https://api.webart.work",sign:{logo:"",email:"",password:""},image:{default:"https://ngx.webart.work/assets/logo.png",logo:"https://ngx.webart.work/assets/logo.png"},meta:{title:"Web Art Work",description:"An amazing solution to build web or mobile app for your business",favicon:"https://ngx.webart.work/assets/favicon.ico",image:"https://ngx.webart.work/assets/logo.png"},defaultLanguageCode:"en",languages:[{name:"Ukrainian",origin:"\u0443\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",code:"uk"},{code:"en",name:"English",origin:"English"}]};var Ce={type:"primary",extraClass:"",disabled:!1,disableSubmit:!1,isMultipleClicksAllowed:!1},Oi="",ln={primary:"wbutton--primary",secondary:"wbutton--secondary",success:"wbutton--success",danger:"wbutton--danger",warning:"wbutton--warning",info:"wbutton--info",light:"wbutton--light",dark:"wbutton--dark",link:"wbutton--link"};var ns=["*"],Ti=(()=>{class i{constructor(){this._cdr=l(ee),this.type=p(Ce.type),this.extraClass=p(Ce.extraClass),this.disabled=p(Ce.disabled),this.disableSubmit=p(Ce.disableSubmit),this.isMultipleClicksAllowed=p(Ce.isMultipleClicksAllowed),this.wClick=T(),this.baseClasses=Oi,this._cooling=!1}get isBlocked(){return this.disabled()||!this.isMultipleClicksAllowed()&&this._cooling}typeClass(){return ln[this.type()]??ln.primary}clicked(e){if(this.isBlocked){e.preventDefault(),e.stopImmediatePropagation();return}this.wClick.emit(e),this.isMultipleClicksAllowed()||(this._cooling=!0,this._cdr.markForCheck(),setTimeout(()=>{this._cooling=!1,this._cdr.markForCheck()},2e3))}resolveType(){return this.disableSubmit()?"button":"submit"}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["wbutton"]],inputs:{type:[1,"type"],extraClass:[1,"extraClass"],disabled:[1,"disabled"],disableSubmit:[1,"disableSubmit"],isMultipleClicksAllowed:[1,"isMultipleClicksAllowed"]},outputs:{wClick:"wClick"},ngContentSelectors:ns,decls:2,vars:4,consts:[[3,"click","type","disabled"]],template:function(n,r){n&1&&(Fn(),ce(0,"button",0),de("click",function(o){return r.clicked(o)}),Nn(1),ke()),n&2&&($("wbutton "+r.baseClasses+" "+r.typeClass()+" "+(r.extraClass()||"")),In("type",r.resolveType())("disabled",r.isBlocked))},styles:["[_nghost-%COMP%]{display:inline-flex;align-items:stretch}.wbutton[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:var(--sp-2);-webkit-user-select:none;user-select:none;white-space:nowrap;border-radius:var(--radius-btn);font-family:var(--ff-base);letter-spacing:var(--letter-spacing);font-weight:500;font-size:.875rem;line-height:1;padding:var(--sp-3) var(--sp-6);border:1px solid transparent;transition:background-color var(--motion) var(--easing),color var(--motion) var(--easing),border-color var(--motion) var(--easing),box-shadow var(--motion-fast) var(--easing),transform var(--motion-fast) var(--easing)}.wbutton[_ngcontent-%COMP%]:focus-visible{outline:none;box-shadow:var(--focus-ring)}.wbutton[_ngcontent-%COMP%]:disabled, .wbutton[aria-disabled=true][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;pointer-events:none}.wbutton--primary[_ngcontent-%COMP%]{background:var(--c-primary);color:var(--c-text-secondary)}.wbutton--primary[_ngcontent-%COMP%]:hover{background:var(--c-primary-hover)}.wbutton--secondary[_ngcontent-%COMP%]{background:var(--c-secondary);color:var(--c-text-secondary)}.wbutton--secondary[_ngcontent-%COMP%]:hover{background:var(--c-secondary-hover)}.wbutton--success[_ngcontent-%COMP%]{background:var(--c-primary);color:var(--c-text-secondary)}.wbutton--success[_ngcontent-%COMP%]:hover{background:var(--c-primary-hover)}.wbutton--danger[_ngcontent-%COMP%]{background:var(--c-secondary);color:var(--c-text-secondary)}.wbutton--danger[_ngcontent-%COMP%]:hover{background:var(--c-secondary-hover)}.wbutton--warning[_ngcontent-%COMP%], .wbutton--info[_ngcontent-%COMP%]{background:var(--c-bg-tertiary);color:var(--c-text-secondary);border-color:var(--c-border)}.wbutton--warning[_ngcontent-%COMP%]:hover, .wbutton--info[_ngcontent-%COMP%]:hover{background:var(--c-bg-secondary)}.wbutton--light[_ngcontent-%COMP%]{background:var(--c-bg-secondary);color:var(--c-text-secondary);border-color:var(--c-border)}.wbutton--light[_ngcontent-%COMP%]:hover{background:var(--c-bg-tertiary)}.wbutton--dark[_ngcontent-%COMP%]{background:var(--c-text-secondary);color:var(--c-bg-secondary)}.wbutton--dark[_ngcontent-%COMP%]:hover{filter:brightness(.95)}.wbutton--link[_ngcontent-%COMP%]{background:transparent;color:var(--c-text-secondary);padding:0;border-color:transparent;border-radius:0}.wbutton--link[_ngcontent-%COMP%]:hover{text-decoration:underline}"],changeDetection:0})}}return i})();var Pi=(()=>{class i extends ge{constructor(){super({name:"formcomponent"}),this.components=f([]),this.get({query:"appId="+He.appId}),this.loaded.subscribe(()=>{this.components.set(this.getDocs())})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var is=()=>[],Ri=()=>({}),rs=(i,t,e,n,r,s,o,a,c,u,_,yt,Gi)=>({props:i,config:t,component:e,wFormId:n,wFormKey:r,wSubmit:s,wChange:o,wClick:a,model:c,fieldTree:u,field:_,submition:yt,key:Gi}),ss=i=>({$implicit:i}),os=(i,t)=>t.key??i;function as(i,t){if(i&1){let e=U();S(0,"form-component",3),N("wSubmit",function(){D(e);let r=v(3);return M(r.wSubmit.emit(r.submition()||{}))})("wChange",function(){D(e);let r=v(3);return M(r.wChange.emit())})("wClick",function(){D(e);let r=v(3);return M(r.wClick.emit())}),E()}if(i&2){let e=v(),n=e.$implicit,r=e.$index,s=v(2);$(Qe("wformc__item ",s.formId()," ",s.formId()+"_"+s.index()+"_"+r," ",n.class||"")),L("formId",s.formId())("component",n)("config",s.config())("submition",s.submition())("model",s.model())("fieldTree",s.fieldTree())("index",s.index()+"_"+r)}}function ls(i,t){if(i&1&&X(0,as,1,12,"form-component",2),i&2){let e=t.$implicit;Q(e.hidden?-1:0)}}function cs(i,t){if(i&1&&(S(0,"div"),ae(1,ls,1,1,null,null,os),E()),i&2){let e=v();$(Xe("wformc ",e.component().class||"")),C(),le(e.component().components??he(3,is))}}function ds(i,t){if(i&1&&(S(0,"div",1),kn(1,4),E()),i&2){let e=v();C(),L("ngTemplateOutlet",e.template())("ngTemplateOutletContext",Rn(18,ss,jn(4,rs,[e.component().props||he(2,Ri),e.config(),e.component(),e.formId(),e.effectiveKey(),e.submit.bind(e),e.change.bind(e),e.click.bind(e),e.model(),e.fieldTree(),e.field,e.submition()||he(3,Ri),e.effectiveKey()])))}}var ji=(()=>{class i{constructor(){this._form=l(De),this.index=p(""),this.formId=p(""),this.config=p.required(),this.component=p.required(),this.submition=p({}),this.model=p(null),this.fieldTree=p(null),this.wSubmit=T(),this.wChange=T(),this.wClick=T(),this.template=f(null),A(()=>{this._form.templatesVersion();let e=this.component().name;this.template.set(e?this._form.getTemplateComponent(e):null)})}hasChildren(){return Array.isArray(this.component().components)&&!!this.component().components?.length}effectiveKey(){let e=this.component().key;if(!e)return null;if(!e.includes("[]"))return e;let n=(this.index()||"").split("_").pop()||"0",r=Number.isFinite(+n)?+n:0;return e.replace(/\[\]/g,`[${r}]`)}get field(){let e=this.fieldTree(),n=this.effectiveKey();return!e||!n?null:e[n]}submit(){this.wSubmit.emit(this.submition()||{})}change(){this.wChange.emit()}click(){this.wClick.emit()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["form-component"]],inputs:{index:[1,"index"],formId:[1,"formId"],config:[1,"config"],component:[1,"component"],submition:[1,"submition"],model:[1,"model"],fieldTree:[1,"fieldTree"]},outputs:{wSubmit:"wSubmit",wChange:"wChange",wClick:"wClick"},decls:2,vars:1,consts:[[3,"class"],[1,"wformc"],[3,"class","formId","component","config","submition","model","fieldTree","index"],[3,"wSubmit","wChange","wClick","formId","component","config","submition","model","fieldTree","index"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,r){n&1&&X(0,cs,3,4,"div",0)(1,ds,2,20,"div",1),n&2&&Q(r.hasChildren()?0:r.component().name&&r.template()?1:-1)},dependencies:[i,Ln],styles:["[_nghost-%COMP%]{display:block;position:relative}.wformc[_ngcontent-%COMP%]{position:relative;padding:0}.wformc__item[_ngcontent-%COMP%]{display:block;margin:0 0 10px}"],changeDetection:0})}}return i})();var us=()=>({}),hs=(i,t)=>t.key??i;function fs(i,t){if(i&1&&(S(0,"h1",0),ue(1),E()),i&2){let e=v();C(),On(e.title)}}function ms(i,t){if(i&1){let e=U();S(0,"form-component",3),N("wSubmit",function(){D(e);let r=v();return M(r.onSubmit())})("wChange",function(){D(e);let r=v();return M(r.onLegacyChange())})("wClick",function(){D(e);let r=v();return M(r.onClick())}),E()}if(i&2){let e=t.$implicit,n=t.$index,r=v(),s=St(0),o=St(1);$(Qe("wform__component ",r.formId," ",r.formId+"_"+n," ",e.class||"")),L("formId",r.formId)("component",e)("config",s)("submition",o)("model",r.model)("fieldTree",r.fieldTree)("index",""+n)}}var _t=(()=>{class i{constructor(){this._coreService=l(_e),this._formService=l(De),this._formcomponentService=l(Pi),this.config=p.required(),this.submition=p({}),this.wChange=T(),this.wSubmit=T(),this._components=h(()=>this.config()?.components??[]),this.visibleComponents=h(()=>this._components().filter(e=>!e?.hidden).concat(this._formcomponentService.components().filter(e=>e.formId===this.formId))),this.instance=f(null),A(()=>{let e=this.config(),n=this.submition();if(!e)return;let r=m(()=>this._formService.form(e,n??void 0));this.instance.set(r)}),A(()=>{let e=this.instance();if(!e)return;let n=e.model();this.wChange.emit(n)})}get formId(){return this.instance()?.id??""}get fieldTree(){return this.instance()?.form??null}get model(){return this.instance()?.model??null}get title(){return this.config()?.title}get cssClass(){return this.config()?.class??""}onSubmit(){let e=this.instance(),n=e?e.model():{};this.wSubmit.emit(n)}onLegacyChange(){let e=this.instance(),n=e?e.model():{};console.log(this.submition,n),this._coreService.afterWhile(this,()=>this.wChange.emit(n),150)}onClick(){}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["wform"]],inputs:{config:[1,"config"],submition:[1,"submition"]},outputs:{wChange:"wChange",wSubmit:"wSubmit"},decls:7,vars:7,consts:[[1,"wform__title"],[1,"wform__body",3,"submit"],[3,"class","formId","component","config","submition","model","fieldTree","index"],[3,"wSubmit","wChange","wClick","formId","component","config","submition","model","fieldTree","index"]],template:function(n,r){if(n&1){let s=U();Pn(0)(1),S(2,"div"),X(3,fs,2,1,"h1",0),S(4,"form",1),N("submit",function(a){return D(s),a.preventDefault(),M(r.onSubmit())}),ae(5,ms,1,12,"form-component",2,hs),E()()}if(n&2){Mt(r.config());let s=r.submition();C(),Mt(s||he(6,us)),C(),$(Xe("wform ",r.cssClass)),C(),Q(r.title?3:-1),C(2),le(r.visibleComponents())}},dependencies:[ji],styles:[".wform[_ngcontent-%COMP%]{display:grid;gap:var(--sp-3)}.wform__title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:var(--c-text-secondary)}.wform__subtitle[_ngcontent-%COMP%]{font-size:.9rem;color:var(--c-text-muted)}.wform__grid[_ngcontent-%COMP%]{display:grid;gap:var(--sp-3)}.wform__row[_ngcontent-%COMP%]{display:grid;gap:var(--sp-3);grid-template-columns:repeat(12,minmax(0,1fr))}.wform__cell[_ngcontent-%COMP%]{grid-column:span 12}.wform__cell._span-1[_ngcontent-%COMP%]{grid-column:span 1}.wform__cell._span-2[_ngcontent-%COMP%]{grid-column:span 2}.wform__cell._span-3[_ngcontent-%COMP%]{grid-column:span 3}.wform__cell._span-4[_ngcontent-%COMP%]{grid-column:span 4}.wform__cell._span-5[_ngcontent-%COMP%]{grid-column:span 5}.wform__cell._span-6[_ngcontent-%COMP%]{grid-column:span 6}.wform__cell._span-7[_ngcontent-%COMP%]{grid-column:span 7}.wform__cell._span-8[_ngcontent-%COMP%]{grid-column:span 8}.wform__cell._span-9[_ngcontent-%COMP%]{grid-column:span 9}.wform__cell._span-10[_ngcontent-%COMP%]{grid-column:span 10}.wform__cell._span-11[_ngcontent-%COMP%]{grid-column:span 11}.wform__cell._span-12[_ngcontent-%COMP%]{grid-column:span 12}.wform__actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--sp-2);margin-top:var(--sp-2)}.wform__card[_ngcontent-%COMP%]{border:1px solid var(--c-border);border-radius:var(--radius);background:var(--c-bg-secondary);box-shadow:var(--shadow-sm);padding:var(--sp-4)}"],changeDetection:0})}}return i})();function ps(i,t){if(i&1){let e=U();S(0,"wbutton",6),N("wClick",function(){let r=D(e).$implicit,s=v();return M(s.onButtonClick(r))}),ue(1),E()}if(i&2){let e=t.$implicit,n=v();L("extraClass","w-btn "+(e.class||""))("disabled",n.submitting()),C(),Tn(" ",e.label," ")}}var cn=(()=>{class i{constructor(){this._coreService=l(_e),this._formService=l(De),this.submit=e=>{},this.change=e=>{},this.submitting=f(!1),this.resetOnSubmit=!1}_sync(e){if(!e)return;this._coreService.copy(e,this.submition);let n=e.data;n&&typeof n=="object"&&(this.submition.data=this.submition.data||{},this._coreService.copy(n,this.submition.data))}handleSubmit(e){this.submitting.set(!0);try{this._sync(e),this.submit(this.submition),this.close()}finally{this.submitting.set(!1),this.resetOnSubmit&&this.form.formId&&this._formService.reset(this.form.formId)}}handleChange(e){this._sync(e),this.change(this.submition)}onButtonClick(e){this.submitting()||(e.click(this.submition,this.close),this.resetOnSubmit&&this.form.formId&&this._formService.reset(this.form.formId))}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["ng-component"]],decls:7,vars:2,consts:[["formRef",""],[1,"modal-form"],[1,"modal-form__body"],[3,"wSubmit","wChange","submition","config"],[1,"modal-form__actions"],["type","primary",3,"extraClass","disabled"],["type","primary",3,"wClick","extraClass","disabled"]],template:function(n,r){if(n&1){let s=U();S(0,"div",1)(1,"div",2)(2,"wform",3,0),N("wSubmit",function(a){return D(s),M(r.handleSubmit(a))})("wChange",function(a){return D(s),M(r.handleChange(a))}),E()(),S(4,"div",4),ae(5,ps,2,3,"wbutton",5,An),E()()}n&2&&(C(2),L("submition",r.submition)("config",r.form),C(3),le(r.modalButtons))},dependencies:[_t,Ti],styles:["[_nghost-%COMP%]{display:block;max-block-size:100%}.modal-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-block-size:100%}.modal-form__body[_ngcontent-%COMP%]{flex:1 1 auto;min-block-size:0;margin-top:var(--sp-3)}.modal-form__actions[_ngcontent-%COMP%]{position:sticky;inset-block-end:calc(-1 * var(--sp-4));padding-block-start:var(--sp-3);padding-block-end:var(--sp-3);background:var(--c-bg-secondary)}.modal-form__actions[_ngcontent-%COMP%]   .w-btn[_ngcontent-%COMP%]{width:100%;display:block}"],changeDetection:0})}}return i})();var Bi=(()=>{class i{constructor(){this._http=l(Pt),this.form=p.required(),this.module=p.required(),this.field=p.required(),this.doc=p.required()}get getDoc(){return this.doc()}change(e){this._http.post(`/api/${this.module()}/unique${this.field()||""}`,this.doc()).subscribe(n=>{this.doc()[this.field()]!==n&&(this.doc()[this.field()]=n)})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["ng-component"]],inputs:{form:[1,"form"],module:[1,"module"],field:[1,"field"],doc:[1,"doc"]},decls:1,vars:2,consts:[[3,"wChange","config","submition"]],template:function(n,r){n&1&&(S(0,"wform",0),N("wChange",function(o){return r.change(o)}),E()),n&2&&L("config",r.form())("submition",r.getDoc)},dependencies:[_t],encapsulation:2,changeDetection:0})}}return i})();function gs(i,t){if(i&1){let e=U();ce(0,"button",4),de("wClick",function(){D(e);let r=v();return M(r.close())}),ue(1," close "),ke()}}var Li=(()=>{class i{constructor(){this.closable=!0,this.close=()=>{},this.size="mid",this.panelClass="",this._popStateHandler=e=>this.popStateListener(e)}ngOnInit(){typeof this.onClickOutside!="function"&&(this.onClickOutside=this.close),typeof this.onOpen=="function"&&this.onOpen(),window.addEventListener("popstate",this._popStateHandler)}ngOnDestroy(){window.removeEventListener("popstate",this._popStateHandler)}onBackdropClick(){this.onClickOutside?.()}popStateListener(e){this.close?.()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["lib-modal"]],decls:4,vars:3,consts:[[1,"wacom-modal","fixed","inset-0","z-[9999]","flex","items-center","justify-center","p-6","md:p-10","bg-black/55",3,"click"],[1,"wacom-modal__content","relative","flex","flex-col","w-full","max-h-[90vh]","overflow-hidden","shadow-[0_18px_45px_rgba(0,0,0,0.6)]",3,"click"],[1,"wacom-modal__body","flex-1","min-h-0","overflow-auto","p-4","md:p-6","pr-14"],["wbutton","","type","button","aria-label","Close",1,"wacom-modal__close","material-icons","absolute","top-3","right-3","inline-flex","!h-10","!w-10","items-center","justify-center","!rounded-full","!p-0","text-[var(--c-text-secondary)]","hover:bg-white/10","focus-visible:outline-none"],["wbutton","","type","button","aria-label","Close",1,"wacom-modal__close","material-icons","absolute","top-3","right-3","inline-flex","!h-10","!w-10","items-center","justify-center","!rounded-full","!p-0","text-[var(--c-text-secondary)]","hover:bg-white/10","focus-visible:outline-none",3,"wClick"]],template:function(n,r){n&1&&(ce(0,"div",0),de("click",function(){return r.onBackdropClick()}),ce(1,"div",1),de("click",function(o){return o.stopPropagation()}),En(2,"div",2),X(3,gs,2,0,"button",3),ke()()),n&2&&(C(),$("bg-[var(--c-bg-secondary)] text-[var(--c-text-primary)] rounded-[var(--radius-card)] "+(r.panelClass||"")+" "+(r.size==="small"?"max-w-md":"")+(!r.size||r.size==="mid"?" max-w-4xl":"")+(r.size==="big"?" max-w-6xl":"")+(r.size==="full"?" max-w-[1440px] max-h-[calc(100vh-3rem)] md:max-h-[calc(100vh-5rem)]":"")),C(2),Q(r.closable?3:-1))},styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return i})();var Ui={size:"mid",timeout:0,class:"",panelClass:"",closable:!0};var $i=(()=>{class i{constructor(){this._dom=l(vi),this._modals=[],this._config=d({},Ui)}show(e){let n=this._withConfig(e);if(n.unique&&this._modals.find(a=>a.unique===n.unique))return this._modals.find(a=>a.unique===n.unique);this._modals.push(n),n.class||="",n.panelClass||=n.class||"",n.id||=Math.floor(Math.random()*Date.now())+Date.now(),document.body.classList.add("modalOpened");let r,s;n.close=()=>{s?.remove(),s=void 0,r?.remove(),r=void 0,typeof n.onClose=="function"&&n.onClose(),this._modals=this._modals.filter(a=>a.id!==n.id),this._modals.length||document.body.classList.remove("modalOpened")},typeof n.timeout=="number"&&n.timeout>0&&setTimeout(()=>n.close?.(),n.timeout),r=this._dom.appendComponent(Li,n);let o=r.nativeElement.children[0].children[0].children[0];return s=this._dom.appendComponent(n.component,n,o),n}open(e){this.show(e)}small(e){this.show(g(d({},e),{size:"small"}))}mid(e){this.show(g(d({},e),{size:"mid"}))}big(e){this.show(g(d({},e),{size:"big"}))}full(e){this.show(g(d({},e),{size:"full"}))}destroy(){for(let e=this._modals.length-1;e>=0;e--)this._modals[e].close?.()}setConfig(e){this._config=d(d({},this._config),e)}_withConfig(e){let r=typeof e=="function"?g(d({},this._config),{component:e}):g(d(d({},this._config),e),{component:e.component});return!r.panelClass&&r.class&&(r.panelClass=r.class),r}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var De=(()=>{class i extends ge{constructor(){super({name:"form"}),this._modalService=l($i),this._storeService=l(Rt),this._injector=l(j),this.appId=He.appId,this._templateComponent=new Map,this.templatesVersion=f(0),this.templateFields={},this.customTemplateFields={},this.forms=[],this.formIds=f([]),this._signalForms=new Map,this._storeService.getJson("formIds",e=>{Array.isArray(e)&&this.formIds.set(e)}),this.get({query:"appId="+He.appId})}addTemplateComponent(e,n){this._templateComponent.has(e)||(this._templateComponent.set(e,n),this.templatesVersion.update(r=>r+1))}removeTemplateComponent(e){this._templateComponent.delete(e)&&this.templatesVersion.update(n=>n+1)}getTemplateComponent(e){return this._templateComponent.get(e)??null}getTemplateComponentsNames(){return Array.from(this._templateComponent.keys())}getTemplateFields(e){return this.templateFields[e]||["Placeholder","Label"]}setTemplateFields(e,n,r={}){this.templateFields[e]=n,this.customTemplateFields[e]=d(d({},this.customTemplateFields[e]||{}),r)}getCustomTemplateFields(e){return this.customTemplateFields[e]||{}}getDefaultForm(e,n=["name","description"]){this._rememberFormId(e);let r=n.map((s,o)=>{let a=s.includes(".")?s.split(".")[1]:"Text",c=(s.split(".")[0]||s).replace(/\[\]|\[\d+\]/g,"");return{name:a,key:s,focused:o===0,props:{placeholder:`Enter your ${c}`,label:c.charAt(0).toUpperCase()+c.slice(1)}}});return{formId:e,components:r}}form(e,n){e.formId&&this._rememberFormId(e.formId);let r=e.formId||crypto.randomUUID();e.formId=r;let s=this._signalForms.get(r);if(s)return n&&Object.keys(n).length&&s.model.update(_=>d(d({},_),n)),s;let o=this._buildInitialModel(e,n??{}),a=f(o),c=Ve(this._injector,()=>rn(a,_=>{this._applyValidators(_,e)})),u={id:r,model:a,form:c};return this._signalForms.set(r,u),u}_buildInitialModel(e,n={}){let r=d({},n);return this._traverseComponents(e.components,s=>{s.key&&(s.key in r||(r[s.key]=null))}),r}_applyValidators(e,n){this._traverseComponents(n.components,r=>{if(!r.key)return;let s=e[r.key];if(!s)return;let o=r.props?.label??r.key;r.required&&xi(s,{message:`${o} is required`})})}_traverseComponents(e,n){if(e?.length)for(let r of e)n(r),r.components?.length&&this._traverseComponents(r.components,n)}modal(e,n=[],r={data:{}},s=a=>{},o={}){return(Array.isArray(e)?e:[e]).forEach(c=>this.form(c,r)),new Promise(c=>{this._modalService.show(g(d({},o),{component:cn,class:"forms_modalService",size:"big",form:e,modalButtons:Array.isArray(n)?n:[n],submition:r,onClose:()=>c(r),submit:u=>c(u),change:u=>{typeof s=="function"&&s(u)}}))})}modalDocs(e,n="Modify content of documents"){return new Promise(r=>{let s={docs:JSON.stringify(e.length?e:[],null,4)};this._modalService.show({component:cn,class:"forms_modalService",size:"big",submition:s,form:{title:n,components:[{name:"Ace",key:"docs",props:{placeholder:"Fill content of documents..."}}]},modalButtons:[{label:"Update",click:(o,a)=>{a();let c=s.docs?JSON.parse(s.docs):[];r(c)}}]})})}modalUnique(e,n,r,s="",o=()=>{}){let a=this.getDefaultForm("unique",[n+(s?"."+s:"")]);this.form(a,r),this._modalService.show({component:Bi,form:a,module:e,field:n,doc:r,class:"forms_modalService",onClose:o})}getComponent(e,n){return this._getComponent(e.components,n)||{}}getProp(e,n,r){return this.getComponent(e,n)?.props?.[r]??null}setProp(e,n,r,s){let o=this.getComponent(e,n);o&&(o.props=o.props||{},o.props[r]=s)}_getComponent(e=[],n){for(let r of e||[]){if(r.key===n)return r;if(r.components?.length){let s=this._getComponent(r.components,n);if(s)return s}}return null}_rememberFormId(e){e&&(this.formIds().includes(e)||(this.formIds.update(n=>(n.push(e),n)),this._storeService.setJson("formIds",this.formIds())))}reset(e,n={}){let r=this._signalForms.get(e);r&&r.model.set(n)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{Ds as a,ot as b,ri as c,Hs as d,Mr as e,qs as f,Ar as g,po as h,_e as i,_i as j,go as k,_o as l,yo as m,yi as n,Pt as o,Rt as p,ge as q,vi as r,vo as s,bo as t,rn as u,Kr as v,Jr as w,jo as x,Bo as y,xi as z,He as A,Ce as B,Ti as C,Pi as D,$i as E,De as F};
