import{o as h,r as n}from"./chunk-QOT76O5U.js";import{L as a,u as i,y as l}from"./chunk-H5N67KS5.js";var c=(()=>{let s=class s extends n{constructor(){super({name:"translatephrase",unauthorized:!0}),this.phrases=a(this.getDocs()),this.loaded.subscribe({next:()=>{this.phrases.set(this.getDocs())}}),this.get().subscribe(()=>{this.phrases.set(this.getDocs())})}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var b=(()=>{let s=class s extends n{constructor(){super({name:"translate",unauthorized:!0,replace:e=>{e.slug=e.phrase+e.language}}),this._phraseService=l(c),this._emitterService=l(h),this._phrases={},this._translates={},this._signalTranslates={},this._phrasesInitialized=!1,this._languageId="",this._recalcPending=!1,this._recalcInProgress=!1,this.filteredDocuments(this._translates,{field:"slug",filtered:()=>this._scheduleRecalc()}),this._phraseService.loaded.subscribe(()=>{this._phrasesInitialized=!0}),this._phraseService.filteredDocuments(this._phrases,{field:"text",filtered:()=>this._scheduleRecalc()}),this._emitterService.on("languageId").subscribe(e=>{this.loadTranslate(e)})}loadTranslate(e){this._languageId!==e&&(this._languageId=e,this.get({query:"language="+e}).subscribe(()=>{this._scheduleRecalc()}))}translate(e){return this._signalTranslates[e]||=a(this._getTranslation(e)),this._signalTranslates[e]}_scheduleRecalc(){this._recalcPending||(this._recalcPending=!0,queueMicrotask(()=>{this._recalcPending=!1,this._reTranslateNow()}))}_reTranslateNow(){if(!this._recalcInProgress){this._recalcInProgress=!0;try{for(let e of Object.keys(this._signalTranslates))if(this._phrases[e]?.length){let t=this._getTranslation(e);this._signalTranslates[e]()!==t&&this._signalTranslates[e].set(t)}else this._phrasesInitialized&&this._languageId}finally{this._recalcInProgress=!1}}}_getTranslation(e){if(this._phrases[e]?.length&&this._languageId){let t=this._phrases[e][0]._id+this._languageId;if(this._translates[t]?.length)return this._translates[t][0].text}return e}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();export{c as a,b};
