import{o as l,r as n}from"./chunk-QOT76O5U.js";import{L as a,u as r,y as h}from"./chunk-H5N67KS5.js";var o=(()=>{let t=class t extends n{constructor(){super({name:"translatephrase",unauthorized:!0}),this.phrases=a(this.getDocs()),this.loaded.subscribe({next:()=>{this.phrases.set(this.getDocs())}}),this.get().subscribe(()=>{this.phrases.set(this.getDocs())})}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var T=(()=>{let t=class t extends n{constructor(){super({name:"translate",unauthorized:!0,replace:s=>{s.slug=s.phrase+s.language}}),this._phraseService=h(o),this._emitterService=h(l),this._phrases={},this._translates={},this._signalTranslates={},this._phrasesInitialized=!1,this._languageId="",this.filteredDocuments(this._translates,{field:"slug",filtered:this._reTranslate.bind(this)}),this._phraseService.loaded.subscribe(()=>{this._phrasesInitialized=!0}),this._phraseService.filteredDocuments(this._phrases,{field:"text",filtered:this._reTranslate.bind(this)}),this._emitterService.on("languageId").subscribe(s=>{this.loadTranslate(s)})}loadTranslate(s){this._languageId!==s&&(this._languageId=s,this.get({query:"language="+s}).subscribe(this._reTranslate.bind(this)))}translate(s){return this._signalTranslates[s]||=a(this._getTranslation(s)),this._signalTranslates[s]}_reTranslate(){console.log("_reTranslate",this._signalTranslates);for(let s in this._signalTranslates)if(console.log("creating",this._phrases[s],{text:s}),this._phrases[s]?.length){let e=this._getTranslation(s);this._signalTranslates[s]()!==e&&this._signalTranslates[s].set(e)}else this._phrasesInitialized&&this._languageId}_getTranslation(s){if(this._phrases[s]?.length&&this._languageId){let e=this._phrases[s][0]._id+this._languageId;if(this._translates[e]?.length)return this._translates[e][0].text}return s}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();export{o as a,T as b};
