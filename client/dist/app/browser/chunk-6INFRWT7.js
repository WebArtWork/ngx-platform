import{a as W,b as X,c as Y}from"./chunk-WPS2QVKK.js";import"./chunk-2T5BTVFY.js";import{a as h}from"./chunk-B4L2IYVK.js";import{a as o}from"./chunk-45SFJVD6.js";import"./chunk-BJZLS4P7.js";import{b as K}from"./chunk-P54445ST.js";import{f as G}from"./chunk-INPKZIN2.js";import"./chunk-XDLC4A3K.js";import{a as J}from"./chunk-MQXU7KO6.js";import{a as Q}from"./chunk-73YO2PIT.js";import{k as D,w as q,x as z}from"./chunk-4NITVLUQ.js";import{Ab as R,B as r,Bb as $,Fa as w,G as v,H as b,Ha as M,Ja as y,O as N,P as E,Wa as P,Xa as U,aa as u,ba as S,fa as C,ga as V,nb as B,ob as H,r as L,tb as A,va as g,vb as O,wa as m,wb as d,xa as p,ya as j}from"./chunk-VOU2RNQA.js";import{a as x,e as T}from"./chunk-FDERIQAA.js";var I={formId:"phrase",title:"Phrase",components:[{name:"Input",key:"text",props:{label:"Origin text",placeholder:"Enter origin text...",type:"textarea",disabled:!0}},{name:"Input",key:"translation",focused:!0,props:{label:"Translation",placeholder:"Enter translation text...",type:"textarea"}}]};var k={formId:"language",components:[{name:"Input",key:"name",focused:!0,props:{placeholder:"Enter language name ...",label:"Language name"}}]};var Z=(()=>{class n extends D{constructor(e){super(k,r(h),e,"language"),this.configType="local",this._languageService=r(o),this._form=r(h),this._cdr=r($),this.searchable=d(!0,{}),this.clearable=d(!0,{}),this.disabled=d(!1,{}),this.isMutatable=d(!1,{}),this.wModel=R(null,{alias:"wModel"}),this.wChange=O(),this.placeholder=A(()=>(this.documents().length?"Select language":"Create new language")+"...",{}),this.buttons=N([],{}),this._languageService.loaded.pipe(L(1)).subscribe(()=>{this.setDocuments()}),E(()=>{if(this._languageService.language()?._id&&this.wModel.set(this._languageService.language()?._id),this.isMutatable()){let t=!!this._languageService.language()?._id;this.buttons.set([{icon:t?"edit":"",click:()=>this.mutate(!0)},{icon:t?"delete":"",click:()=>this.deleteCurrent()},{icon:"add",click:()=>this.mutate(!1)}])}this._cdr.markForCheck()})}mutate(e=!0){let t=this.wModel()??null,a=e?this._languageService.getSignal(t):void 0;this._form.modal(k,{label:e?"Update":"Create",click:(i,l)=>{e&&this._languageService.language()?this._languageService.update(x(x({},this._languageService.language()),i)).subscribe(()=>{this.setDocuments()}):this._languageService.create(i).subscribe(s=>{this.setDocuments(),this._languageService.setLanguage(s),this.wModel.set(s._id),this.wChange.emit(s._id)}),l()}},a?.())}deleteCurrent(){let e=this._languageService.language();e&&(this._languageService.languages().length>1?(this._languageService.nextLanguage(),console.log(this._languageService.language()),this.wModel.set(this._languageService.language()?._id)):this._languageService.setLanguageId(),this._languageService.delete(e).subscribe(()=>{this.setDocuments()}))}static{this.\u0275fac=function(t){return new(t||n)(u(o))}}static{this.\u0275cmp=S({type:n,selectors:[["language-selector"]],inputs:{searchable:[1,"searchable"],clearable:[1,"clearable"],disabled:[1,"disabled"],isMutatable:[1,"isMutatable"],wModel:[1,"wModel"]},outputs:{wModel:"wModelChange",wChange:"wChange"},features:[C],decls:2,vars:9,consts:[[3,"wChange","placeholder","disabled","searchable","clearable","buttons","wModel","items"]],template:function(t,a){if(t&1){let i=w();m(0,"wselect",0),B(1,"translate"),M("wChange",function(s){return v(i),a.wModel.set(s),b(a.wChange.emit(s))}),p()}if(t&2){let i=a.documents();g("placeholder",H(1,7,a.placeholder())())("disabled",a.disabled()||!i.length)("searchable",a.searchable())("clearable",a.clearable())("buttons",a.buttons())("wModel",a.wModel())("items",i)}},dependencies:[K,G],encapsulation:2,changeDetection:0})}}return n})();function ae(n,f){if(n&1){let e=w();m(0,"language-selector",4),M("wChange",function(a){v(e);let i=y();return b(i.languageService.setLanguageId((a??"")+""))}),p()}if(n&2){let e,t=y();g("wModel",(e=t.languageService.language())==null?null:e._id)("isMutatable",!0)("clearable",!1)}}function ne(n,f){if(n&1&&P(0),n&2){let e=f.$implicit;U(e.text)}}function ie(n,f){if(n&1&&j(0,"span",5),n&2){let e=f.$implicit;g("translate",e.text)}}var ee=(()=>{class n extends D{allowCreate(){return!1}allowUrl(){return!1}update(e){let t=this._languageService.language()?._id??"",a=e._id;if(t){let i=this._translateService.translate(e.text);this._formService.modal(I,{label:"Update",click:(l,s)=>T(this,null,function*(){s();let c=l.translation;i()!==c&&(yield this._translateService.updateTranslation(c,a,t),i.set(c))})},{translation:i()===e.text?"":i(),text:e.text})}else this._alertService.show({text:"Please select language first"})}constructor(e,t){super(I,e,t,"phrase"),this._formService=e,this._phraseService=t,this._translateService=r(z),this.updatableFields=["_id","text"],this._languageService=r(o),this._alertService=r(Q),this.columns=["phrase","translation"],this.configType="local",this.config=this.getConfig(),this.languageService=r(o),this.config.headerButtons.unshift({icon:"edit",click:()=>{let a=this._languageService.language()?._id??"";if(a){let i=[];for(let l of this._phraseService.getDocs())i.push(this._translateService.translate(l.text)());this._formService.modalDocs(i,"Update translations for "+this._languageService.language()?.name).then(l=>T(this,null,function*(){console.log(l);for(let[s,c]of this._phraseService.getDocs().entries()){let _=l[s];if(_===void 0)continue;let F=this._translateService.translate(c.text);F()!==_&&(yield this._translateService.updateTranslation(_,c._id,a),F.set(_))}}))}else this._alertService.show({text:"Please select language first"})}}),this.setDocuments()}static{this.\u0275fac=function(t){return new(t||n)(u(h),u(q))}}static{this.\u0275cmp=S({type:n,selectors:[["ng-component"]],features:[C],decls:4,vars:3,consts:[["title","Translates",3,"rows","columns","config"],["tableHeader",""],["cell","phrase"],["cell","translation"],[3,"wChange","wModel","isMutatable","clearable"],[3,"translate"]],template:function(t,a){t&1&&(m(0,"wtable",0),V(1,ae,1,3,"ng-template",1)(2,ne,1,1,"ng-template",2)(3,ie,1,1,"ng-template",3),p()),t&2&&g("rows",a.documents())("columns",a.columns)("config",a.config)},dependencies:[Y,Z,W,X,J],encapsulation:2,changeDetection:0})}}return n})();var Ue=[{path:"",component:ee}];export{Ue as routes};
