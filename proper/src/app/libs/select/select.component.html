@let _showOptions = showOptions(); @let _placeholder = placeholder(); @let
_label = label(); @let _activeValue = activeValue(); @let _activeValues =
activeValues(); @let _multiple = multiple(); @let _searchable = searchable();
@let _allItems = allItems(); @let _searchableBy = searchableBy(); @let _search =
search();

<div
	(clickOutside)="toggleOptions(false)"
	style="color: black"
	class="w-select"
>
	<!-- Label for the select field -->
	@if (_label) {
	<div class="w-select__label">{{ _label | translate }}</div>
	}

	<!-- Select body containing the selected item(s) and dropdown -->
	<div
		[class._disabled]="disabled()"
		[class._active]="_showOptions"
		class="w-select__body"
	>
		<!-- Select header with the selected item(s) -->
		<div (click)="toggleOptions()" class="w-select__header">
			<span class="material-icons">unfold_more</span>
			<!-- Display the selected items -->
			<ng-container
				[ngTemplateOutlet]="t_view() ? t_view() : defaultView"
			></ng-container>
			<ng-template #defaultView>
				<div class="w-select__text">
					@if (_multiple) {
					<div class="text-overflow">
						@if (!_activeValues.length) {
						<div>{{ _placeholder | translate }}</div>
						} @for (id of _activeValues; track id; let i = $index) {
						<span>
							@if (i && allItem[id]) {
							<span>, </span>
							} @if (allItem[id]) {
							<span
								>{{ allItem[id] | translate }}
								<i
									class="material-icons avatar__icon"
									(click)="removeItem(i)"
									>close</i
								>
							</span>
							}
						</span>
						}
					</div>
					} @else {
					<div class="text-overflow">
						{{ (_activeValue ? allItem[_activeValue] : _placeholder)
						| translate }}
					</div>
					}
				</div>
			</ng-template>
		</div>

		<!-- Clearable icon -->
		@if (clearable() && (_multiple ? _activeValues.length : _activeValue)) {
		<div class="w-select__arrow material-icons" (click)="clear()">
			close
		</div>
		}

		<!-- Dropdown arrow -->
		<div
			class="w-select__arrow material-icons"
			[class._active]="_showOptions"
			(click)="toggleOptions()"
		>
			expand_more
		</div>

		<!-- Dropdown menu -->
		@if (_showOptions) {
		<div [class._search]="_searchable" class="w-select__popup">
			@if (_searchable) {
			<div>
				<ng-container
					[ngTemplateOutlet]="t_search() ? t_search() : defaultSearch"
				></ng-container>
				<ng-template #defaultSearch>
					<winput
						placeholder="{{'Select.Enter search text...' | translate}}"
						(wChange)="search.set($event + '')"
						[focused]="true"
					/>
				</ng-template>
			</div>
			}

			<!-- Items list -->
			<div class="popup-block">
				@for (item of (_allItems | search: _search: _searchableBy + '
				__search'); track item().id) {
				<ng-container
					[ngTemplateOutlet]="t_item() ? t_item() : defaultItem"
					[ngTemplateOutletContext]="{ item: item }"
				></ng-container>
				} @if (!(_allItems | search: _search: _searchableBy + '
				__search')?.length) {
				<div class="popup-block__empty-search" translate>
					Select.Nothing was found
				</div>
				}
			</div>

			<!-- Item view -->
			<ng-template #defaultItem let-item="item">
				<div (click)="selectOption(item())" class="item">
					@let id = item().id;

					<div
						[class.selected]="_multiple ? _activeValues.includes(id) : false"
						class="item__text"
					>
						@if (item()[bindLabel()]) { {{ item()[bindLabel()] |
						translate }} } @else { {{'Select.Unknown item' |
						translate}} }
					</div>
				</div>
			</ng-template>
		</div>
		}
	</div>
</div>
